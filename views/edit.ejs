<!DOCTYPE HTML>
<html>
  <head>
  <meta charset='utf-8'>
    <!-- <meta name='viewport', content='width=device-width, initial-scale=1.0'> -->
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta name='description', content='wenwo,问我,当地人,旅游,攻略,信息,分享'>
    <meta name='author', content='raodqi'>
    <link rel="icon" type="image/x-icon" href="/img/logo.png" media="screen">
    <title>问我——像个当地人一样去旅游</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_1468485343_2436674.css">
    <link rel="stylesheet" href="/css/sm.min.css">
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=cb84c659c88a7cc83b935a009b3a9cfd&plugin=AMap.Geocoder"></script>
    <script src="/js/jweixin-1.0.0.js"></script>
  </head>
  <style>
    body{
      padding:0;
      margin:0;
    }
    .page{
      background: white !important;
    }
    .edit-ul{
      padding-left: 2rem;
      margin-top: 2rem;
    }
    .edit-li{
      padding-left: 1.5rem;
    }
    .tag{
      border-left: 2px solid #2B82FD;
    }
    .reason{
      border-left: 2px solid #F13A01;
    }
    .detail{
      border-left: 2px solid #F4BC1C;
    }
    .name{
      border-left: 2px solid #5459CD;
    }
    .address{
      border-left: 2px solid #42B93A;
    }
    .price{

    }
    .li-title{
      font-size: 0.7rem;
      color: #333333;
    }
    .edit-content{
      padding:0.5rem 0;
      color: #CCCCCC;
      font-size: 0.6rem;
      word-break:break-all;
    }
    .edit-li-img{
      width: 30px;
      height: 30px;
      float: left;
      margin-top: -0.25rem;
      margin-left:-2.25rem;
      background-color: white;
      border-radius: 50%;
      background-size: cover;
    }
    .footer-bar{
      width: 100%;
      position: absolute;
      bottom: 2rem;
      height: 40px;
    }
    .pre-view{
      position: absolute;
      left:30px;
      background: #FFF url("/img/edit/left.png");
      background-size: cover;
      width: 100px;
      height: 39px;
      text-align: center;
      line-height: 39px;
      color: #999999;
      padding-left: 20px;
      font-size: 14px;
    }
    .next-view,.end-view{
      position: absolute;
      right: 30px;
      background: #FFF url("/img/edit/right.png");
      background-size: cover;
      width: 100px;
      height: 39px;
      text-align: center;
      line-height: 39px;
      color: #999999;
      padding-right: 20px;
      font-size: 14px;
    }
    .header-bar{
      position: absolute;
      width: 100%;
      top:40px;
    }
    .header-content{
      width: 84%;
      margin-left:8%;
    }
    .line{
      width: 100%;
      border: 1px solid #D4D4D4;
    }
    .circle{
      width: 8px;
      height: 8px;
      border-radius: 50%;
      position: absolute;
      margin-top: -4px;
    }
    .circle-index{
      margin-left: 0%;
      background-color: #50C3E8;
    }
    .circle-tag{
      margin-left: 14%;
      background-color: #2B82FD;
    }
    .circle-reason{
      margin-left: 28%;
      background-color: #F13A01;
    }
    .circle-detail{
      margin-left: 42%;
      background-color: #F4BC1C;
    }
    .circle-name{
      margin-left: 56%;
      background-color: #5459CD;
    }
    .circle-address{
      margin-left: 70%;
      background-color: #42B93A;
    }
    .circle-price{
      margin-left: 84%;
      background-color: #F88827;
    }
    .circle-img{
      width: 30px;
      height: 30px;
      margin-left: -10px;
      margin-top: -10px;
      border-radius: 50%;
    }
    .icon-left{
      color:#F88827;
      font-weight: bolder;
      margin-left: 5px;
    }
    .send-button-a{
      display: block;
      width: 1rem !important;
      height: 1.1rem !important;
      background-image: url("/img/edit/edit.svg");
      background-size: cover;
      margin: 13px 5px 0 0 !important;
    }
    .circle-hide{
      width: 0;
    }
    .page-content{
      margin-top: 5rem;
    }
    .ww-typeHelper-left{
      text-align: center;
    }
    .ww-typeHelper-input{
      border: 0 !important;
      padding:10px 10px;
      text-align: center;
      font-size: 15px !important;
      border-bottom: 2px solid #999999 !important;
    }
    .techTags{
      padding: 1rem;
    }
    .tag-ul{
      text-align: center;
    }
    .type-item{
      margin:5px 5px;
      display: inline-block;
      background: #EE7E2E;
      color:white;
      padding:6px 16px;
      font-size: 14px;
      border-radius: 20px;
    }
    input:-ms-input-placeholder,
    textarea:-ms-input-placeholder {
        color: #CCCCCC;
    }
    input::-webkit-input-placeholder,
    textarea::-webkit-input-placeholder {
        color: #CCCCCC;
    }
    .reason-content,.detail-content,.li-content{
      width: 80%;
      margin:0 auto;
      padding-top: 1rem;
    }
    #reason,#detail{
      margin-top: .5rem;
      width: 100%;
      height: 6rem;
      padding:.5rem;
    }
    #name,#price{
      margin-top: .5rem;
      width: 100%;
      height: 37px;
      padding-left: 10px;
      font-size: 14px;
    }
    /*这里是设置输入框的点击效果*/
    #name:focus,#price:focus {
        outline: -webkit-focus-ring-color auto 5px;
    }
    input,textarea{
      resize: none;
    }
    .detail-li input{
      border: 0 !important;
      width: 100%;
      padding: 0 10px;
    }
    .detail-li-title{
      background: url("/img/edit/detail-li.png") no-repeat; 
      width: 60px;
      height: 26px;
      background-size: 100% 26px;
    }
    .add-content,#container{
      width: 100%;
      height: 100%;
    }
    .add-header{
      background:rgba(255,255,255,0.5);
      top:10px;
      width: 90%;
      height: 6rem;
      margin-left: 5%; 
      z-index: 2;
    }
    .add-header .header-content{
      margin-top: 1.2rem;
    }
    #address{
      width: 90%;
      border-radius: 6px;
      border: 1px solid #EE7E2E;
      height: 1.5rem;
      margin:50px 5% 0;
      padding-left: 28px;
      font-size: 14px;
    }
    .icon-bianji{
      position: absolute;
      color: #EE7E2E;
      font-size: 20px;
      bottom: 12px;
      margin-left: 23px;
    }
    .tip{
      margin-top: 10px;
    }
    .tip-img{
      display: block;
      position: absolute;
      width: 13px;
      height: 13px;
      margin-top:6.5px;
    }
    .tip-text{
      font-size: 12px;
      color: #CCCCCC;
      margin-left: 15px;
    }
  }
  </style>
  <body>
    <div class="page page-current" id='router'>
      <header class="bar bar-nav">
        <a class="button button-link button-nav pull-left">
          <span class="icon icon-left"></span>
        </a>
        <h1 class='title'>发布</h1>
        <a class="button button-link button-nav pull-right send-button-a"></a>
      </header>
      <div class="content">
        <div class="theme-content-block">        
          <div class="edit-ul">
            <!-- 标签 -->
            <div class="edit-li tag" data-href="#router1">
              <img src="/img/edit/tag-01.png" class="edit-li-img">
              <div class="li-title">
                标签
              </div>
              <div class="edit-content">
                请填写标签
              </div>
            </div>
            <!-- 推荐理由 -->
            <div class="edit-li reason" data-href="#router2">
              <img src="/img/edit/reason-01.png" class="edit-li-img">
              <div class="li-title">
                推荐理由
              </div>
              <div class="edit-content">
                请填写推荐理由
              </div>
            </div>
            <!-- 信息详情 -->
            <div class="edit-li detail" data-href="#router3">
              <img src="/img/edit/detail-01.png" class="edit-li-img">

              <div class="li-title">
                信息详情
              </div>
              <div class="edit-content">
                请填写信息详情
              </div>
            </div>
            <!-- 店名 -->
            <div class="edit-li name" data-href="#router4">
              <img src="/img/edit/name-01.png" class="edit-li-img">

              <div class="li-title">
                店名
              </div>
              <div class="edit-content">
                请填写店名
              </div>
            </div>
            <!-- 地址 -->
            <div class="edit-li address" data-href="#router5">
              <img src="/img/edit/address-01.png" class="edit-li-img">

              <div class="li-title">
                地址
              </div>
              <div class="edit-content">
                请填写地址
              </div>
            </div>
            <!-- 价格 -->
            <div class="edit-li price" data-href="#router6">
              <img src="/img/edit/price-01.png" class="edit-li-img">

              <div class="li-title">
                价格
              </div>
              <div class="edit-content">
                请填写价格
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
    <!-- 标签填写 -->
    <div class="page" id='router1'>

      <header class="header-bar">
        <div class="header-content">
          <div class="line"></div>
          <div class="circle circle-index" data-href="#router"></div>
          <div class="circle circle-tag" data-href="#router1">
            <img src="/img/edit/tag-02.png" class="circle-img">
          </div>
          <div class="circle circle-reason" data-href="#router2"></div>
          <div class="circle circle-detail" data-href="#router3"></div>
          <div class="circle circle-name" data-href="#router4"></div>
          <div class="circle circle-address" data-href="#router5"></div>
          <div class="circle circle-price" data-href="#router6"></div>
        </div>
      </header>

      <div class="page-content">
        <div class="tag-content">
          <div class="ww-typeHelper">
            <div class="ww-typeHelper-left">
              <input type="text" data-role="ww_typeHelper-input" class="ww-typeHelper-input" placeholder="填入或选择信息的标签">
            </div>        
          </div>
          <div role="tabpanel" class="techTags panel-default techTags-panel" data-tech="">
            <div class="tag-ul">
              <span class="type-item">火锅</span>
              <span class="type-item">羊肉泡馍</span>
              <span class="type-item">绝味</span>
              <span class="type-item">羊肉泡馍</span>
              <span class="type-item">羊肉泡馍</span>
            </div>
            
          </div>
        </div>
      </div>

      <footer class="footer-bar">
        <div class="pre-view" data-href="#router">
          预览
        </div>
        <div class="next-view" data-href="#router2">
          下一步
        </div>
      </footer>
    </div>
    <!-- 推荐理由填写 -->
    <div class="page" id='router2'>
      <header class="header-bar">
        <div class="header-content">
          <div class="line"></div>
          <div class="circle circle-index" data-href="#router"></div>
          <div class="circle circle-tag" data-href="#router1"></div>
          <div class="circle circle-reason" data-href="#router2">
            <img src="/img/edit/reason-02.png" class="circle-img">
          </div>
          <div class="circle circle-detail" data-href="#router3"></div>
          <div class="circle circle-name" data-href="#router4"></div>
          <div class="circle circle-address" data-href="#router5"></div>
          <div class="circle circle-price" data-href="#router6"></div>
        </div>
      </header>

      <div class="page-content">
        <div class="reason-content li-content">
          <div class="reason-title">您推荐这家店的理由：</div>
          <div class="recommend-reason">
            <textarea name="reason" id="reason" placeholder=""></textarea>
          </div>
        </div>
      </div>

      <footer class="footer-bar">
        <div class="pre-view" data-href="#router">
          预览
        </div>
        <div class="next-view" data-href="#router3">
          下一步
        </div>
      </footer>
    </div>
    <!-- 信息详情填写 -->
    <div class="page" id='router3'>
      <header class="header-bar">
        <div class="header-content">
          <div class="line"></div>
          <div class="circle circle-index" data-href="#router"></div>
          <div class="circle circle-tag" data-href="#router1"></div>
          <div class="circle circle-reason" data-href="#router2"></div>
          <div class="circle circle-detail" data-href="#router3">
            <img src="/img/edit/detail-02.png" class="circle-img">
          </div>
          <div class="circle circle-name" data-href="#router4"></div>
          <div class="circle circle-address" data-href="#router5"></div>
          <div class="circle circle-price" data-href="#router6"></div>
        </div>
      </header>
      <div class="page-content">
        <div class="detail-content li-content">
          <div class="detail-title">请告诉我们一些详细信息：</div>
          <div class="recommend-detail">
            <textarea name="detail" id="detail" placeholder=""></textarea>
          </div>

          <div class="detail-li-content">
            <div class="detail-li">
              <div class="detail-li-title">
                <input type="text" name="" class="detail-li-name" value="环境">
              </div>
              <input type="text" class="detail-li-val">
            </div>
          </div>
        </div>
      </div>


      <footer class="footer-bar">
        <div class="pre-view" data-href="#router">
          预览
        </div>
        <div class="next-view" data-href="#router4">
          下一步
        </div>
      </footer>
    </div>
    <!-- 店名填写 -->
    <div class="page" id='router4'>
      <header class="header-bar">
        <div class="header-content">
          <div class="line"></div>
          <div class="circle circle-index" data-href="#router"></div>
          <div class="circle circle-tag" data-href="#router1"></div>
          <div class="circle circle-reason" data-href="#router2"></div>
          <div class="circle circle-detail" data-href="#router3"></div>
          <div class="circle circle-name" data-href="#router4">
            <img src="/img/edit/name-02.png" class="circle-img">
          </div>
          <div class="circle circle-address" data-href="#router5"></div>
          <div class="circle circle-price" data-href="#router6"></div>
        </div>
      </header>

      <div class="page-content">
        <div class="name-content li-content">
          <div class="name-title">请输入这家店的名字：</div>
          <div class="recommend-name">
            <input type="text" name="name" id="name" placeholder="">
          </div>
        </div>
      </div>

      <footer class="footer-bar">
        <div class="pre-view" data-href="#router">
          预览
        </div>
        <div class="next-view" data-href="#router5">
          下一步
        </div>
      </footer>
    </div>
    <!-- 图片添加 -->
    <div class="page" id='router5'>
      <header class="header-bar add-header">
        <div class="header-content">
          <div class="line"></div>
          <div class="circle circle-index" data-href="#router"></div>
          <div class="circle circle-tag" data-href="#router1"></div>
          <div class="circle circle-reason" data-href="#router2"></div>
          <div class="circle circle-detail" data-href="#router3"></div>
          <div class="circle circle-name" data-href="#router4"></div>
          <div class="circle circle-address" data-href="#router5">
            <img src="/img/edit/address-02.png" class="circle-img">
          </div>
          <div class="circle circle-price" data-href="#router6"></div>
        </div>
        <div class="add-search">
          <input type="text" class="search-input" id="address" name="address" placeholder="">
          <div class="ww_typeHelper-input-left iconfont icon-bianji"></div>
        </div>
      </header>

      <div class="add-content">
        <div id="container"></div>
      </div>

      <footer class="footer-bar">
        <div class="pre-view" data-href="#router">
          预览
        </div>
        <div class="next-view" data-href="#router6">
          下一步
        </div>
      </footer>
    </div>
    <!-- 地点标注 -->
     <div class="page" id='router6'>
      <header class="header-bar">
        <div class="header-content">
          <div class="line"></div>
          <div class="circle circle-index" data-href="#router"></div>
          <div class="circle circle-tag" data-href="#router1"></div>
          <div class="circle circle-reason" data-href="#router2"></div>
          <div class="circle circle-detail" data-href="#router3"></div>
          <div class="circle circle-name" data-href="#router4"></div>
          <div class="circle circle-address" data-href="#router5"></div>
          <div class="circle circle-price circle-hide" data-href="#router6">
            <img src="/img/edit/price-02.png" class="circle-img">
          </div>
        </div>
      </header>

      <div class="page-content">
        <div class="price-content li-content">
          <div class="price-title">请输入想设置的价格：</div>
          <div class="recommend-price">
            <input type="text" name="price" id="price" placeholder="">
          </div>
          <div class="tip">
            <img src="/img/edit/tip.png" class="tip-img" alt="">
            <label class="tip-text">您设置的价格在累积到10次查看后，开始付费查看</label>
          </div>
        </div>
      </div>

      <footer class="footer-bar">
        <div class="pre-view" data-href="#router">
          预览
        </div>
        <div class="next-view" data-href="#router">
          完成
        </div>
      </footer>
    </div>

  </body>
  <script type='text/javascript' src='/js/zepto.min.js' charset='utf-8'></script>
  <script type='text/javascript' src='/js/sm.min.js' charset='utf-8'></script>
  <script type="text/javascript" src="/js/common.js"></script>
  <script type="text/javascript" src="/js/map.js"></script>
  <script type="text/javascript" src="/js/wxlocation.js"></script>
  <script> 
    $(".tab-item").on("click",function(){
      // console.log($());
      var type = $(this).attr("data-type");
      console.log(type);
      $(".tab-item").removeClass("active");
      $(this).addClass("active");
      if(type == "like"){
        $.router.load("/food?username=573b0e3df38c8400673bb48d#like"); 
      }else if(type == "find"){
        $.router.load("/food?username=573b0e3df38c8400673bb48d");
        // $.router.back();
      }
    })

    $("#router .icon-left").on("click",function(){
      var url = window.location.hash;
      if(!url.split("#")[1]){
        $.showPreloader("正在跳转");
        $.router.back();
      }else{
        $.showPreloader("正在跳转");
        $.router.load("/food");
      }
    })

    $(".edit-li,.next-view,.pre-view,.circle").on("click",function(){
      var href = $(this).attr("data-href");
      if(href.split("#")[1]){
        $.router.load(href);
      }else{
        $.router.load("#"+href);
      }
      
    })
  </script>
  <script>
  initLocation();
  window.onload = function() {
    map.plugin(["AMap.ToolBar"], function() {
      map.addControl(new AMap.ToolBar());
    });
    $.hidePreloader();
  }

  //初始化,异步获取标签
  function getTag(themeType){

    $.showPreloader("正在加载");

    var data = {
      type   :  themeType,
      size   :  10
    }
    $.ajax({
      type : "GET",
      data: data,
      dataType: "json",
      url : "/ask/gettag",
      success: function(result){
        $.hidePreloader();
        console.log(result);
        if(result.code == 200){
          var li = ''
          for(var i in result.data){
            var exit = 0;

            $.each($(".ww-typeHelper .type-item"),function(j,v){
              // console.log(result.data[i].tagName);
              // console.log($(v).text());
              if(result.data[i].tagName == $(v).text()){
                exit = 1;
              }
            })
            console.log(exit);
            if(!exit && result.data[i].tagName){
              li += '<span class="type-item">'+result.data[i].tagName+'</span>';
            }
            
          }
          $(".tag-li").empty();
          $(".tag-li").append(li);
        }
        
      },
      error:function(error){
        $.hidePreloader();
        console.log(error);
      }
    })
  }

  //获取二级标签
  $("#tag-content,#router1 .next").on("click",function(){
    console.log(localStorage.type);
    var LStype = localStorage.type;
    if(LStype){
      getTag(LStype);
    }
  })


    var marker;
    //获取地址
    function getAddress(lnglatXY,callback){
      var geocoder = new AMap.Geocoder({
            radius: 1000,
            extensions: "all"
        });        
        geocoder.getAddress(lnglatXY, function(status, result) {
            if (status === 'complete' && result.info === 'OK') {
              var address = result.regeocode; //返回地址描述
              console.log(address);
              callback.success(address);
              // console.log(address);

              // if(type == "detail"){
              //   console.log(address.formattedAddress);
              //   return address.formattedAddress;
              // }
              var address = {
                province : address.addressComponent.province,
                city     : address.addressComponent.city,
                district : address.addressComponent.district
              }
              // console.log(address);
              // return address;
            }
        }); 
    }

    //

    //初始化localStorage数据
    function initLocationData(){

      //初始化标签
      console.log(localStorage.tag);
      if(localStorage.tag){
        tag = JSON.parse(localStorage.tag);
        console.log(tag);
        var spanContent = '';
        for(var i in tag){
          console.log(tag[i]);
          var spanContent = spanContent + '<span class="type-item">'+tag[i]+'</span>';
        }
        // $(".ww-typeHelper-input").before(spanContent);
        $(".ww-typeHelper-left").before(spanContent);
        $("#tag-content .card-content-inner").append(spanContent);
      }

      //初始化推荐理由
      console.log(localStorage.reason);
      if(localStorage.reason){
        $("#reason").val(localStorage.reason);
        $("#reason-content .card-content-inner").text(localStorage.reason);
      }

      //初始化信息详情
      console.log(localStorage.detail);
      if(localStorage.detail){
        $("#detail").val(localStorage.detail);

        var str = {};
        str = localStorage.detail.split("##");
        var show = '';
        var hidden = '';
        var detail = ''
        for(var i = 0; i < str.length; i++){
          if(i%2){
            var starLen = ''
            for(var j = 0; j < str[i].length; j++){
              starLen += '*';
            }
            detail += '<span class="hidden-text">'+starLen+'</span>';
          }else{
            detail += str[i];
          }
        }
        $(".de-show").empty();
        $(".de-show").append(detail);

        $("#detail-content .card-content-inner").text(localStorage.detail);
        deShow(localStorage.detail);
      }

      //初始化地址信息
      if(localStorage.address){
        $("#address").val(localStorage.address);
      }
      //初始化坐标信息
      console.log(localStorage.lng);
      console.log(localStorage.lat);
      var lnglatXY = [localStorage.lng,localStorage.lat];
      // getAddress(lnglatXY);
      // var detail = getAddress(lnglatXY,"detail");
      // console.log(detail);

      if(localStorage.lng && localStorage.lat){

        // address.formattedAddress
        getAddress(lnglatXY,{
          success:function(address){
            var detail = address.formattedAddress;
            var address = {
              province : address.addressComponent.province,
              city     : address.addressComponent.city,
              district : address.addressComponent.district,
              township : address.addressComponent.township
            }
            // var address = JSON.stringify(address);

            // detail = detail.replace(address[0]+address[1]+address[2]+address[3],"");
            var replace = ""+address.province+address.city+address.district+address.township+"";
            detail = detail.replace(replace,"");
            address.detail = detail;
            address = JSON.stringify(address);
            console.log(address);
            $("#address-content .item-inner").attr("data-address",address);
            $("#address-content .item-inner").text(detail);
          }
        });

        $("#container").attr("data-lng",localStorage.lng);
        $("#container").attr("data-lat",localStorage.lat);

        //详情地点显示
        map = new AMap.Map('container', {
          resizeEnable: true,
          zoom:15,
          center: [localStorage.lng,localStorage.lat],
          buttonOffset: new AMap.Pixel(60, 20),//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
          zoomToAccuracy: true,      //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
          buttonPosition:'LB'
        });
        // var marker = new AMap.Marker({
        //   map : map,
        //   tagName:"火锅;超辣的",
        //   askReason:"味道真的不错",
        //   askContentShow:"这里的味道真的不错",
        //   price:0.2,
        //   createBy:"hanqi",
        //   createAt:"2016-04-19",
        //   zoom:15,
        //   center: [localStorage.lng,localStorage.lat],
        //   position: [localStorage.lng,localStorage.lat],
        //   draggable: true,
        //   cursor: 'move',
        //   raiseOnDrag: true,
        //   clickable:true
        // });

        // mapShow = new AMap.Map('container-show', {
        //   resizeEnable: true,
        //   zoom:15,
        //   center: [localStorage.lng,localStorage.lat]
        // });

        marker = new AMap.Marker({
          map : map,
          position: [localStorage.lng,localStorage.lat],
          draggable: true,
          cursor: 'move',
          raiseOnDrag: true,
          clickable:true
        });

        // var markerShow = new AMap.Marker({
        //   map : mapShow,
        //   position: [localStorage.lng,localStorage.lat],
        //   draggable: true,
        //   cursor: 'move',
        //   raiseOnDrag: true,
        //   clickable:true
        // });

         marker.setMap(map);
         // markerShow.setMap(mapShow);
      }else{
        $("#address-content .item-inner").text("地点");
      }

      //初始化价格信息
      console.log(localStorage.price);
      if(localStorage.price){
        $("#price-picker").val(localStorage.price);
        // $("#price-content .card-content-inner").text("￥ "+localStorage.price);
        $("#price-content .item-inner").text(localStorage.price);
      }
    }

    function formatDetail(data){
      console.log(data);
      var staus           = data.staus,     //状态
          askTagStr       = data.askTagStr, //标签
          reason          = data.askReason, //理由
          askContentHide  = data.askContentHide,//隐藏详情
          askContentShow  = data.askContentShow,//隐藏详情
          lnglatXY        = [data.GeoX,data.GeoY],//坐标
          lng             = data.GeoX,
          lat             = data.GeoY,
          price           = data.askPrice,//价格
          updatedAt       = data.updatedAt,//发布时间
          createBy        = data.createBy;//发布者

      //标签
      var tag = JSON.parse(askTagStr);
        console.log(tag);
        var spanContent = '';
        for(var i in tag){
          console.log(tag[i]);
          var spanContent = spanContent + '<span class="type-item">'+tag[i].tag_name+'</span>';
        }
        // $("#tag-content .card-content-inner").append(spanContent);
        $(".ww-typeHelper-left").before(spanContent);
        $("#tag-content .card-content-inner").append(spanContent);

        //推荐理由
        $("#reason").val(reason);
        $("#reason-content .card-content-inner").text(reason);

        //解析详情
        var show = askContentShow.split("##");
        var hidden = askContentHide.split("##");
        var reasonDetail = '';
        console.log("len:"+hidden.length);
        for(var i = 0; i < hidden.length;i++){
          if(hidden[i]){
            reasonDetail += show[i] + "##"+ hidden[i] + "##";
          }
        }
        if(!hidden.length){
          reasonDetail = show;
        }

        $("#detail-content .card-content-inner").text(reasonDetail);
        $("#detail").val(reasonDetail);
        deShow(reasonDetail);

        // var str = {};
        // str = localStorage.detail.split("##");
        // var show = '';
        // var hidden = '';
        // var detail = ''
        // for(var i = 0; i < str.length; i++){
        //   if(i%2){
        //     var starLen = ''
        //     for(var j = 0; j < str[i].length; j++){
        //       starLen += '*';
        //     }
        //     detail += '<span class="hidden-text">'+starLen+'</span>';
        //   }else{
        //     detail += str[i];
        //   }
        // }
        // $(".de-show").empty();
        // $(".de-show").append(detail);

        // $("#detail-content .card-content-inner").text(localStorage.detail);

        //解析地址
        getAddress(lnglatXY,{
          success:function(address){
            var detail = address.formattedAddress;
            var address = {
              province : address.addressComponent.province,
              city     : address.addressComponent.city,
              district : address.addressComponent.district,
              township : address.addressComponent.township
            }
            // var address = JSON.stringify(address);

            // detail = detail.replace(address[0]+address[1]+address[2]+address[3],"");
            var replace = ""+address.province+address.city+address.district+address.township+"";
            detail = detail.replace(replace,"");
            address.detail = detail;
            address = JSON.stringify(address);
            console.log(address);
            $("#address-content .item-inner").attr("data-address",address);
            $("#address-content .item-inner").text(detail);
          }
        });

        $("#container").attr("data-lng",lng);
        $("#container").attr("data-lat",lat);

        //详情地点显示
        map = new AMap.Map('container', {
          resizeEnable: true,
          zoom:15,
          center: [lng,lat],
          buttonOffset: new AMap.Pixel(60, 20),//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
          zoomToAccuracy: true,      //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
          buttonPosition:'LB'
        });
        // var marker = new AMap.Marker({
        //   map : map,
        //   tagName:"火锅;超辣的",
        //   askReason:"味道真的不错",
        //   askContentShow:"这里的味道真的不错",
        //   price:0.2,
        //   createBy:"hanqi",
        //   createAt:"2016-04-19",
        //   zoom:15,
        //   center: [localStorage.lng,localStorage.lat],
        //   position: [localStorage.lng,localStorage.lat],
        //   draggable: true,
        //   cursor: 'move',
        //   raiseOnDrag: true,
        //   clickable:true
        // });

        // mapShow = new AMap.Map('container-show', {
        //   resizeEnable: true,
        //   zoom:15,
        //   center: [localStorage.lng,localStorage.lat]
        // });

        marker = new AMap.Marker({
          map : map,
          position: [lng,lat],
          draggable: true,
          cursor: 'move',
          raiseOnDrag: true,
          clickable:true
        });

        // var markerShow = new AMap.Marker({
        //   map : mapShow,
        //   position: [localStorage.lng,localStorage.lat],
        //   draggable: true,
        //   cursor: 'move',
        //   raiseOnDrag: true,
        //   clickable:true
        // });

         marker.setMap(map);

        //价格
        console.log(price);
        if(price){
          $("#price-picker").val(price);
          // $("#price-content .card-content-inner").text("￥ "+localStorage.price);
          $("#price-content .item-inner").text(price);
        }
       
  }

    function initEditData(sendAskId){
      $.ajax({
        type: "get",
        url: '/ask/askdetail',
        data: {ask_id:sendAskId,username:"<%= username %>"},
        dataType: "json",
        success : function(result) {
          console.log(result);
          if(result.code == 200){
            formatDetail(result.data);
          }
        },
        error : function(error){
          $.alert("网络异常");
        }
      })
    }

    var sendType = "<%= type %>";
    var sendAskId = "<%= askid %>";
    if(sendType == "edit"){
      console.log("edit");
      $("#router .title").text("编辑");
      initEditData(sendAskId);
    }else{
      $("#router .title").text("发布");
      initLocationData();
    }

    
  </script>
  <script>
    $(".card,.theme-list-content").on("click",function(){
      var href = $(this).data("href");
      if(href){
        $.router.load("#"+href);
      }
    })

    //帮助
    $(".help").on("click",function(){
      if($(".help-content").hasClass("help-content-active")){
        $(".help-content").hide();
        $(".help-content").removeClass("help-content-active");
      }else{
        $(".help-content").show();
        $(".help-content").addClass("help-content-active");
      }
    })

    //选择主题
    $(".theme-ul .theme-li").on("click",function(){
      // $(".theme-li").removeClass("active-first");
      // // console.log($(".active").length);
      // $(this).addClass("active-first");
      // if($(this).hasClass("active")){
      //   $(this).removeClass("active");
      //   $(".theme1").attr("data-type",$("#"+$(".theme-li.active")[0].id).attr("data-type"));
      //   $(".theme1").text($("#"+$(".theme-li.active")[0].id).text());
      //   $(".theme2").addClass("theme-hidden");
      // }else{
      //   // $(this).addClass("active");
      //   if($(".active").length < 2){
      //     // $(".theme-li.active-first").removeClass("active");
      //     $(".theme1").attr("data-type",$(this).attr("data-type"));
      //     $(".theme1").text($(this).text());
      //     $(this).addClass("active");
      //     $(".theme2").addClass("theme-hidden");
      //     if($(".active").length == 2){
      //       console.log($(".theme-li.active"));
      //       // $(".theme1").attr("data-type")
      //       // $(".theme1").attr("data-type",$(this).attr("data-type"));
      //       // $(".theme1").text($(this).attr("data-text"));
      //       $(".theme1").attr("data-type",$("#"+$(".theme-li.active")[0].id).attr("data-type"));
      //       $(".theme1").text($("#"+$(".theme-li.active")[0].id).text());
      //       $(".theme2").attr("data-type",$("#"+$(".theme-li.active")[1].id).attr("data-type"));
      //       $(".theme2").text($("#"+$(".theme-li.active")[1].id).text());
      //       $(".theme2").removeClass("theme-hidden");
      //     }

      //   }else{
      //     $.alert("最多只能选择两个主题");
      //   }
      var type = $(this).data("type");
      console.log(type);
      if($(this).hasClass("theme-li-active")){
        console.log("remove");
        $(this).removeClass("theme-li-active");
        $(".theme-list"+type).removeClass("theme-list-active");
      }else{
        var len = $(".theme-li-active").length;
        if(len < 2){
          $(this).addClass("theme-li-active");
          $(".theme-list"+type).addClass("theme-list-active");
          // if("")
        }else{
          $.toast("最多只能选择两个主题");
        }
      }

      //获取主题
        var $_active = $(".theme-li-active");
        if(!$_active.length){

        }else{
          if($_active.length == 1){
            var type = $(".theme-li-active").attr("data-type");
          }else{
            var type = $("#"+$(".theme-li-active")[0].id).attr("data-type") + ","+$("#"+$(".theme-li-active")[1].id).attr("data-type");
          }
          localStorage["type"] = type;
        }
      
      // }
      // console.log($(".active").length);
      // if($(".active").length == 3){
      //   // $(".theme-li.active-first").removeClass("active");
      // }

        //获取主题
        // var $_active = $(".theme-li.active");
        // if(!$_active.length){

        // }else{
        //   if($_active.length == 1){
        //     var type = $(".theme-li.active").attr("data-type");
        //   }else{
        //     var type = $("#"+$(".theme-li.active")[0].id).attr("data-type") + ","+$("#"+$(".theme-li.active")[1].id).attr("data-type");
        //   }
        //   localStorage["type"] = type;
        // }
    })

    function setlocalStorageTag(){
      //获取填写的tag
        var $_tag = $(".ww-typeHelper .type-item");
        var tag = {};
        if(!$_tag.length){
          localStorage["tag"] = '';
        }else{
          $.each($_tag,function(i,v){
            tag[i] = $(this).text();
          })
          tag = JSON.stringify(tag);
          localStorage["tag"] = tag;
        }
    }
    //在输入框内添加标签
    $(".ww-typeHelper-input").on("input change",function(){
      console.log($(this).val());
      var text = $(this).val();
      if(text.indexOf(";")!=-1 || text.indexOf("；")!=-1 || text.indexOf(",")!=-1 || text.indexOf("，")!=-1){
        var text = text.substr(0,text.length-1);
        $(".ww-typeHelper-input").val(text);
        
        var len = GetLength(text);
        console.log(len);
        if(len > 10){
          $.toast("标签字数过多");
          return;
        }
        var tagNum = $(".tag-content .ww-typeHelper .type-item").length;
        if(tagNum >= 3){
          $.toast("最多只能选择三个二级标签");
          return;
        }

        console.log(text);
        var span = '<span class="type-item">'+text+'</span>';
        // $("this").before(span);
        $(".ww-typeHelper-left").before(span);
        $(this).val('');
        $("#tag-content .card-content-inner").append(span);
        setlocalStorageTag();
      }
    })

    $(".ww_typeHelper-button").on("click",function(){

      console.log($(".ww-typeHelper-input").val());
      var text = $(".ww-typeHelper-input").val();
      var len = GetLength(text);
      console.log(len);
      if(len > 10){
        $.toast("标签字数过多");
        return;
      }
      var tagNum = $(".tag-content .ww-typeHelper .type-item").length;
      if(tagNum >= 3){
        $.toast("最多只能选择三个二级标签");
        return;
      }
      
      var span = '<span class="type-item">'+text+'</span>';
      $(".ww-typeHelper-left").before(span);
      $(".ww-typeHelper-input").val('');
      $("#tag-content .card-content-inner").append(span);

      // if(text.indexOf(";")!=-1 || text.indexOf("；")!=-1 || text.indexOf(",")!=-1 || text.indexOf("，")!=-1){
      //   var text = text.substr(0,text.length-1);
      //   console.log(text);
      //   var span = '<span class="type-item">'+text+'</span>';
      //   // $("this").before(span);
      //   $(".ww-typeHelper-left").before(span);
      //   $(this).val('');
      //   $("#tag-content .card-content-inner").append(span);
      //   setlocalStorageTag();
      // }
    })

    //点击二级标签删除主页二级标签
    $(".ww-typeHelper").on("click",".type-item",function(){
      console.log($(".tag-content .ww-typeHelper .type-item").length);

      $(this).remove();
      var $_this = $(this);
      var span = '<span class="type-item">'+ $(this).text()+'</span>';
      $(".tag-li").append(span);
      $.each($("#tag-content .type-item"),function(i,v){
        console.log($(v).text());
        if($(v).text() == $_this.text()){
          $(v).remove();
        }
      })
      //获取填写的tag
      setlocalStorageTag();
    })
    //点击默认标签添加标签
    $(".tag-ul").on("click",".type-item",function(){
      console.log($(".tag-content .ww-typeHelper .type-item").length);
      var tagNum = $(".tag-content .ww-typeHelper .type-item").length;
      if(tagNum >= 3){
        $.toast("最多只能选择三个二级标签");
        return;
      }

      var span = '<span class="type-item">'+ $(this).text()+'</span>';
      $(this).remove();
      // $(".ww-typeHelper-input").before(span);
      $(".ww-typeHelper-left").before(span);
      $("#tag-content .card-content-inner").append(span);
      //获取填写的tag
      setlocalStorageTag();
    })

    //推荐理由输入后显示到主页
    $("#reason").on("input change",function(){
      $("#reason-content .card-content-inner").text($(this).val());
      localStorage["reason"] = $(this).val();
    })


    $(".button-start,.button-end").on("click",function(){
      var text = $("#detail").val();
      $("#detail").val(text+"##");
      $("#detail-content .card-content-inner").text($("#detail").val());
      localStorage["detail"] = $("#detail").val();
    })

    function getHideText(){
      var text = $("#detail").val();
      // console.log(text.indexOf("##"));
      var str = {};
      str = text.split("##");
      var show = '';
      var hidden = '';
      for(var i = 0; i < str.length; i++){
        if(i%2){
          hidden += str[i]+"##";
        }else{
          if( i == str.length-1){
            show += str[i];
          }else{
            show += str[i]+"##";
          }
          
        }
      }
      var textDetail = {
        show:show,
        hidden:hidden
      }
      return(textDetail);
    }


    //详情输入后显示到主页
    $("#detail").on("input change",function(){
      var text = $("#detail").val();

      //显示到主页
      $("#detail-content .card-content-inner").text(text);
      deShow(text);
      // var str = {};
      // str = text.split("##");
      // var show = '';
      // var hidden = '';
      // var detail = ''
      // for(var i = 0; i < str.length; i++){
      //   if(i%2){
      //     var starLen = ''
      //     for(var j = 0; j < str[i].length; j++){
      //       starLen += '*';
      //     }
      //     detail += '<span class="hidden-text">'+starLen+'</span>';
      //   }else{
      //     detail += str[i];
      //   }
      // }
      // $(".de-show").empty();
      // $(".de-show").append(detail);
      localStorage["detail"] = $("#detail").val();
    })

    // $("#detail").focus(function(){
    //   $("#detail,.de-show").css("height","100px !important");
    // });

    // $("#detail").blur(function(){
    //   $("#detail,.de-show").css("height","150px !important");
    // });

    //更换价格的时候调用
    $("#price-picker").on("input change",function(){
      console.log($(this).val());
      // $("#price-content .card-content-inner").text("￥ "+$(this).val());
      $("#price-content .item-inner").text($(this).val());
      localStorage["price"] = $(this).val();
    })


    //提交所有信息
    $(".send-button-a").on("click",function(){
        var type,//主题类型
            tag = new Array(),//二级标签
            reason,//推荐理由
            content_show,//详情显示部分
            content_hide,//详情隐藏部分
            lng,//经度
            lat,//维度
            isfree = 1,//是否是免费信息
            price = 0.00;//信息价格

        //获取主题
        var $_active = $(".theme-li-active");
        if(!$_active.length){
          $.toast("你还没有选择主题");
          // $.router.load("#router1");
          return;
        }else{
          if($_active.length == 1){
            var type = $(".theme-li-active").attr("data-type");
          }else{
            var type = $("#"+$(".theme-li-active")[0].id).attr("data-type") + ","+$("#"+$(".theme-li-active")[1].id).attr("data-type");
          }
          console.log(type);
        }

        //获取填写的tag
        var $_tag = $(".ww-typeHelper .type-item");
        if(!$_tag.length){
          $.toast("你还没有填写标签");
           return;
        }else{
          $.each($_tag,function(i,v){
            tag[i] = {
              tag_name: $(this).text()
            }
            // $(this).text();
          })
          tag = JSON.stringify(tag);
        }

        //获取推荐理由
        var reason = $("#reason").val();
        if(!reason){
          $.toast("你还没有填写推荐理由");
          return;
        }

        //获取详情
        var detail = $("#detail").val();
        if(!detail){
          $.toast("你还没有填写信息详情");
          return;
        }else{
          var detailContent = getHideText();
          console.log(detailContent);
          content_show = detailContent.show;
          content_hide = detailContent.hidden;
        }

        //获取标注位置的经纬度
        lng = $("#container").attr("data-lng");
        lat = $("#container").attr("data-lat");
        if(!lng || !lat){
          $.toast("你还没有添加地图标注");
          return;
        }

        //获取信息价格
        price = $("#price-picker").val().replace(/\s+/g,"");
        console.log(price);
        if(price == "0 . 0 0" || price == "0.00"){
          isfree = 1;
        }else{
          isfree = 0;
        }
        var data = {
          username     : "<%= username %>",
          type         : type,
          tag          : tag,
          reason       : reason,
          content_show : content_show,
          content_hide : content_hide,
          position     : $("#address-content .item-inner").attr("data-address"),
          geo_x        : lng,
          geo_y        : lat,
          isfree       : isfree,
          price        : price,
          addContent   : $("#address-content .item-inner").text()
        }
        console.log(data);
        // return ;
        //发送请求 url：/ask/sendask
        $.showPreloader("正在提交");

        if(sendType == "edit"){
          data["ask_id"] = sendAskId;
           $.ajax({
            type : "POST",
            data: data,
            dataType: "json",
            url : "/ask/askedit",
            success : function(result){
              console.log(result);
              if(result.code){
                $.hidePreloader();
                $.toast("提交成功");
                localStorage.clear();
                $.showPreloader("正在跳转");
                // window.location.href="/more/information-presentation/test/"+sendAskId+"?username="+"<%=username%>";
                window.location.href="/more/information-presentation/"+sendAskId;
              }else{
                $.hidePreloader();
                $.toast(result.message);
              }
            },
            error: function(error){
              // alert(error);
              $.alert(error);
            }
          });
        }else{
          $.ajax({
            type : "POST",
            data: data,
            dataType: "json",
            url : "/ask/sendask",
            success : function(result){
              console.log(result);
              if(result.code == 200){
                $.hidePreloader();
                $.toast("提交成功");
                localStorage.clear();
                var askId = result.data.objectId;

                $.showPreloader("正在跳转");
                // window.location.href="/more/information-presentation/test/"+askId+"?username="+"<%=username%>";
                window.location.href="/more/information-presentation/"+askId;
              }else{
                $.hidePreloader();
                $.toast(result.message);
              }
            },
            error: function(error){
              // alert(error);
              $.alert(error);
            }
          });
        }
        // $.ajax({
        //   type : "POST",
        //   data: data,
        //   dataType: "json",
        //   url : "/ask/sendask",
        //   success : function(result){
        //     console.log(result);
        //     if(result.code){
        //       $.hidePreloader();
        //       $.toast("提交成功");
        //       localStorage.clear();
        //     }else{
        //       $.hidePreloader();
        //       $.toast(result.message);
        //     }
        //   },
        //   error: function(error){
        //     // alert(error);
        //     $.alert(error);
        //   }
        // });

    })

    //sui框架picker引用（价格选择）
    $("#price-picker").picker({
      toolbarTemplate: '<header class="bar bar-nav">\
      <button class="button button-link pull-right close-picker">确定</button>\
      <h1 class="title">请设置出售价格</h1>\
      </header>',
      rotateEffect:true,
      cols: [
        {
          textAlign: 'center',
          values: ['0']
          //如果你希望显示文案和实际值不同，可以在这里加一个displayValues: [.....]
        },
        {
          textAlign: 'center',
          values: ['.']
        },
        {
          textAlign: 'center',
          values: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']
        },
        {
          textAlign: 'center',
          values: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']
        }
      ]
    });

    // //地点显示
    // mapShow = new AMap.Map('container-show', {
    //     // resizeEnable: true,
    //     // zoomEnable:false,
    //     // dragEnable:false
    //     resizeEnable: true
    // });
    // mapShow.plugin('AMap.Geolocation', function() {
    //     geolocation = new AMap.Geolocation({
    //         enableHighAccuracy: true,//是否使用高精度定位，默认:true
    //         timeout: 10000,          //超过10秒后停止定位，默认：无穷大
    //         zoomToAccuracy: true,      //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
    //     });
    //     geolocation.getCurrentPosition();
    //     AMap.event.addListener(geolocation, 'complete', onComplete);//返回定位信息
    //     AMap.event.addListener(geolocation, 'error', onError);      //返回定位出错信息
    // });

    // //解析定位结果
    // function onComplete(data) {
    //     console.log("定位成功");
    //     var str=['定位成功'];
    //     str.push('经度：' + data.position.getLng());
    //     str.push('纬度：' + data.position.getLat());
    //     str.push('精度：' + data.accuracy + ' 米');
    //     str.push('是否经过偏移：' + (data.isConverted ? '是' : '否'));

    //     // mapShow = new AMap.Map('container-show', {
    //     //     resizeEnable: true,
    //     //     center:[data.position.getLng(),data.position.getLat()],
    //     //     zoom:20
    //     // });
    // }
    // //解析定位错误信息
    // function onError(data) {
    //     console.log("定位失败");
    // }

    //输入框填写的地址内容
    $("#address").on("input change",function(){
      localStorage["address"] = $(this).val();
    })

    var timeIv;
    //地点标注搜索
    AMap.plugin(['AMap.Autocomplete','AMap.PlaceSearch'],function(){
      var autoOptions = {
        input: "address"//使用联想输入的input的id
      };
      autocomplete= new AMap.Autocomplete(autoOptions);
      var placeSearch = new AMap.PlaceSearch({
            map:map
      })
      AMap.event.addListener(autocomplete, "select", function(e){
         //TODO 针对选中的poi实现自己的功能
         // console.log("123");
         // console.log(e);
         // $(".amap-marker").css("display","none !important");
         placeSearch.search(e.poi.name);
         console.log($(".amap-marker"));

         //这里是设置一个延时来判断是否标注加载完成
         timeIv = setInterval(function(){
          console.log($(".amap-marker").length);
          if($(".amap-marker").length > 5){
            clearInterval(timeIv);
            map.clearMap();
          }
         }, 10);
         
      });

      // var placeSearchShow = new AMap.PlaceSearch({
      //       map:mapShow
      // })
      // AMap.event.addListener(autocomplete, "select", function(e){
      //    //TODO 针对选中的poi实现自己的功能
      //    console.log(e);
      //    placeSearchShow.search(e.poi.name)
      // });
    });


    //点击标注
    map.on('click', function(e) {

      //clear all markers
      map.clearMap();
      // mapShow.clearMap();
      lnglatXY = [e.lnglat.getLng(), e.lnglat.getLat()]; //已知点坐标
      getAddress(lnglatXY,{
        success:function(address){
          var detail = address.formattedAddress;
          // var address = {
          //   province : address.addressComponent.province,
          //   city     : address.addressComponent.city,
          //   district : address.addressComponent.district
          // }
          var address = {
              province : address.addressComponent.province,
              city     : address.addressComponent.city,
              district : address.addressComponent.district,
              township : address.addressComponent.township
            }
          // var address = JSON.stringify(address);

          // detail = detail.replace(address[0]+address[1]+address[2]+address[3],"");
          var replace = ""+address.province+address.city+address.district+address.township+"";
          detail = detail.replace(replace,"");
          address.detail = detail;
          var address = JSON.stringify(address);
          console.log(address);
          $("#address-content .item-inner").attr("data-address",address);
          $("#address-content .item-inner").text(detail);
        }
      });

      console.log('您在[ '+e.lnglat.getLng()+','+e.lnglat.getLat()+' ]的位置点击了地图！');
        // alert('您在[ '+e.lnglat.getLng()+','+e.lnglat.getLat()+' ]的位置点击了地图！');
      var icon = new AMap.Icon({
          // image : 'http://vdata.amap.com/icons/b18/1/2.png',//24px*24px
          //icon可缺省，缺省时为默认的蓝色水滴图标，
          // size : new AMap.Size(24,24)
      });
      // var marker = new AMap.Marker({
      //         icon : icon,//24px*24px
      //         offset : new AMap.Pixel(e.lnglat.getLat(),e.lnglat.getLng()),
      //         map : map
      // });
      marker = new AMap.Marker({
        icon : icon,//24px*24px
        map : map,
        tagName:"火锅;超辣的",
        askReason:"味道真的不错",
        askContentShow:"这里的味道真的不错",
        price:0.2,
        createBy:"hanqi",
        createAt:"2016-04-19",
        position: [e.lnglat.getLng(),e.lnglat.getLat()],
        draggable: true,
        cursor: 'move',
        raiseOnDrag: true,
        clickable:true
      });

      // var markerShow = new AMap.Marker({
      //   icon : icon,//24px*24px
      //   map : mapShow,
      //   position: [e.lnglat.getLng(),e.lnglat.getLat()],
      //   draggable: true,
      //   cursor: 'move',
      //   raiseOnDrag: true,
      //   clickable:true
      // });

      localStorage["lng"] = e.lnglat.getLng();
      localStorage["lat"] = e.lnglat.getLat();

      $("#container").attr("data-lng",e.lnglat.getLng());
      $("#container").attr("data-lat",e.lnglat.getLat());
      // //拖动标注后回调的坐标
      //  marker.on("dragend",function(){
      //   console.log(this.getPosition());
      //   var lat = this.getPosition().lat;
      //   var lng = this.getPosition().lng;
      //   $("#container").attr("data-lng",lng);
      //   $("#container").attr("data-lat",lat);

      //   localStorage["lng"] = lng;
      //   localStorage["lat"] = lat;

      //   // mapShow.clearMap();
      //   // var markerShow = new AMap.Marker({
      //   //   icon : icon,//24px*24px
      //   //   map : mapShow,
      //   //   position: [lng,lat],
      //   //   draggable: true,
      //   //   cursor: 'move',
      //   //   raiseOnDrag: true,
      //   //   clickable:true
      //   // });
      // })
      marker.setMap(map);
      // markerShow.setMap(mapShow);
    });
    /*
    相比来说这家鱼火锅是我吃过味道比较好的一家，在##成都信息工程大学北三街##，人均消费20多的样子，可以吃到很饱，素菜是免费的。
    */
    if(marker){
      //拖动标注后回调的坐标
       marker.on("dragend",function(){
        console.log(this.getPosition());
        var lat = this.getPosition().lat;
        var lng = this.getPosition().lng;
        $("#container").attr("data-lng",lng);
        $("#container").attr("data-lat",lat);

        localStorage["lng"] = lng;
        localStorage["lat"] = lat;

        // mapShow.clearMap();
        // var markerShow = new AMap.Marker({
        //   icon : icon,//24px*24px
        //   map : mapShow,
        //   position: [lng,lat],
        //   draggable: true,
        //   cursor: 'move',
        //   raiseOnDrag: true,
        //   clickable:true
        // });
        var lnglatXY = [lng,lat];
        getAddress(lnglatXY,{
          success:function(address){
            var detail = address.formattedAddress;
            // var address = {
            //   province : address.addressComponent.province,
            //   city     : address.addressComponent.city,
            //   district : address.addressComponent.district
            // }
            var address = {
              province : address.addressComponent.province,
              city     : address.addressComponent.city,
              district : address.addressComponent.district,
              township : address.addressComponent.township
            }
            // var address = JSON.stringify(address);

            var replace = ""+address.province+address.city+address.district+address.township+"";
            detail = detail.replace(replace,"");
            address.detail = detail;
            console.log(detail);
            var address = JSON.stringify(address);
            console.log(address);
            $("#address-content .item-inner").attr("data-address",address);
            $("#address-content .item-inner").text(detail);
          }
        });
      })
    }
    
  </script>
</html>
