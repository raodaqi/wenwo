<% include header.ejs %>
<link href='http://api.youziku.com/webfont/CSS/578f43dcf629e300d8f428f5' rel='stylesheet' type='text/css' />
<link rel="stylesheet" href="/css/sm-extend.min.css">
<link rel="stylesheet" href="/css/newfood-min.css">
</head>
<body>
 <img src="/img/loading.png" alt="" class="hide-img">
  <div class="wenwo-content page page-current" id='find'>
    <header class="bar bar-nav">
      <div class="header-me iconfont icon-gerenzhongxin"></div>
      <h1 class="title">问我-美食</h1>
    </header>
    <div class="distance distance-fixed">距离1KM</div>
    <!-- 这里是所有的信息列表 -->
    <div class="find-content content pull-to-refresh-content infinite-scroll infinite-scroll-bottom" data-ptr-distance="55" data-distance="100">
      <!-- 默认的下拉刷新层 -->    
      <div class="pull-to-refresh-layer">
        <div class="preloader-tip">刷新成功</div>
        <div class="preloader"></div>
        <div class="pull-to-refresh-arrow"></div>
      </div>


      <!-- Slider -->
      <div class="swiper-container" data-space-between='10' data-loop='true' data-autoplay='7000' data-autoplay-disable-on-interaction='false'>
        <div class="swiper-wrapper">
          <!-- <div class="swiper-slide" data-href="/share/id/57a84fba1532bc0060d62179"><img src="/img/scroll/page2.jpg" alt=""></div>
          <div class="swiper-slide" data-href="/share/id/57a84f52165abd00616471d9"><img src="/img/scroll/page1.jpg" alt=""></div> -->

          
        </div>
        <div class="swiper-pagination"></div>
        <!-- <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div> -->
      </div>
        
      <div class="nav-list-content">

        <div class="nav-list" data-href="#tagfind">
          <div class="nav-icon">
            <label class="iconfont icon-c-classification"></label>
          </div>
          <div class="nav-title">分类查找</div>
        </div>
        <div class="nav-list nav-list-day" data-href="#card">
          <div class="nav-icon">
            <label>-</label>
          </div>
          <div class="nav-title">精选美食卡片</div>
        </div>
        <div class="nav-list" data-href="#strategy">
          <div class="nav-icon">
            <label class="iconfont icon-gonglve"></label>
          </div>
          <div class="nav-title">美食攻略</div>
        </div>
      </div>

      <div class="wenwo-ul">
      </div>
      <div class="infinite-scroll-preloader" >
        <div class="preloader"></div>
        <div class="ask-end" style="display:none">启禀陛下，您已经到底了。</div>
      </div>
    </div>
  </div>

  <!-- 这里是所有的信息列表 -->
  <div class="wenwo-content page" id="like">
    <header class="bar bar-nav">
      <h1 class="title">想吃</h1>
    </header>
    <!-- 这里是想吃的信息列表 -->
    <div class="like-content content pull-to-refresh-content infinite-scroll infinite-scroll-bottom" data-ptr-distance="55" data-distance="100">
      <!-- 默认的下拉刷新层 -->    
      <div class="pull-to-refresh-layer">
        <div class="preloader"></div>
        <div class="pull-to-refresh-arrow"></div>
      </div>
      <div class="wenwo-ul"></div>
      <div class="want-content">
        <img src="/img/food/want-empty.svg" class="empty-img" alt="">
        <div class="empty-title">没有想吃的美食？</div>
        <div class="empty-button" data-href="#find">去随便逛逛</div>

        <div class="wenwo-logo-content">
          <img src="/img/wenwo.svg" class="wenwo-logo" alt="">
          <div class="wenwo-title">
            让经验帮你赚钱
          </div>
        </div>
      </div>
      <div class="infinite-scroll-preloader" >
        <div class="preloader"></div>
        <div class="ask-end" style="display:none">启禀陛下，您已经到底了。</div>
      </div>
    </div>
  </div>
  
  <div class="wenwo-content page" id="buy">
    <header class="bar bar-nav">
      <a class="button button-link button-nav pull-left back" href="#">
        <span class="icon icon-left"></span>
      </a>
      <h1 class="title">朕查阅的</h1>
    </header>
  <!-- 这里是购买的的信息列表 -->
    <div class="buy-content content pull-to-refresh-content infinite-scroll infinite-scroll-bottom" data-ptr-distance="55" data-distance="100">
      <!-- 默认的下拉刷新层 -->    
      <div class="pull-to-refresh-layer">
        <div class="preloader"></div>
        <div class="pull-to-refresh-arrow"></div>
      </div>
      <div class="wenwo-ul"></div>
      <div class="want-content">
        <img src="/img/food/want-empty.svg" class="empty-img" alt="">
        <div class="empty-title">皇上，您还没有查阅任何美食</div>
        <div class="empty-button" data-href="#find">去查阅美食</div>

        <div class="wenwo-logo-content">
          <img src="/img/wenwo.svg" class="wenwo-logo" alt="">
          <div class="wenwo-title">
            让经验帮你赚钱
          </div>
        </div>
      </div>
      <div class="infinite-scroll-preloader" >
        <div class="preloader"></div>
        <div class="ask-end" style="display:none">启禀陛下，您已经到底了。</div>
      </div>
    </div>
  </div>

  <div class="wenwo-content page" id="share">
    <header class="bar bar-nav">
      <a class="button button-link button-nav pull-left back" href="#">
        <span class="icon icon-left"></span>
      </a>
      <h1 class="title">朕分享的</h1>
    </header>
  <!-- 这里是购买的的信息列表 -->
    <div class="share-content content pull-to-refresh-content infinite-scroll infinite-scroll-bottom" data-ptr-distance="55" data-distance="100">
      <!-- 默认的下拉刷新层 -->    
      <div class="pull-to-refresh-layer">
        <div class="preloader"></div>
        <div class="pull-to-refresh-arrow"></div>
      </div>
      <div class="wenwo-ul">
      </div>
      <div class="want-content">
        <img src="/img/food/want-empty.svg" class="empty-img" alt="">
        <div class="empty-title">皇上，您还没有分享的美食</div>
        <div class="empty-button" data-href="edit">点臣妾去分享</div>

        <div class="wenwo-logo-content">
          <img src="/img/wenwo.svg" class="wenwo-logo" alt="">
          <div class="wenwo-title">
            让经验帮你赚钱
          </div>
        </div>
      </div>
      <div class="infinite-scroll-preloader" >
        <div class="preloader"></div>
        <div class="ask-end" style="display:none">启禀陛下，您已经到底了。</div>
      </div>
    </div>
  </div>

  <!-- 这里是所有的信息列表 -->
  <div class="wenwo-content page" id="me">
    <header class="bar bar-nav">
      <a class="button button-link button-nav pull-left back" href="#">
        <span class="icon icon-left"></span>
      </a>
      <h1 class="title">个人中心</h1>
    </header>
    <div class="content">
      <div class="detail-pic-bg">

        <i class="ui-loading-bright"></i>

        <div class="detail-pic-content" style="display:none">
          <!-- <img src="http://wx.qlogo.cn/mmopen/zngt7mjBQUdFiaKIVGQbhF3jRURfqibW3EtNPALJewxicdPAyGfyMpZkeHZIW1UXUmjEia3QicdYqickSiaywQcKBUS6GMWSEw67Rry/" alt="" class="pic-bg"> -->
          <div class="pic-bg" style='background: url("/img/head.png") center center / cover no-repeat'></div>
          <div class="bg-mask"></div>

          <div class="user-pic-content">
            <img src="/img/head.png" alt="" class="user-pic">
            <div class="user-name">饶大奇</div>
          </div>
        </div>

        <div class="list-content" style="display:none">
          <div class="list-li">
            <label class="list-li-like-num">22</label>
            <label>想吃</label>
          </div>
          <div class="list-li">
            <label class="list-li-like-share">27</label>
            <label>分享</label>
          </div>
          <div class="list-li">
            <label class="list-li-like-total">253.86</label>
            <label>总收益</label>
            <span class="icon iconfont icon-tixing"></span>
          </div>
        </div>

        <div class="list-block">
          <ul class="my-ask">
            <li class="item-content item-link" data-href="#buy">
              <div class="before-media"><i class="iconfont icon-shoppingcart"></i></div>
              <div class="item-media"><i class="icon icon-f7"></i></div>
              <div class="item-inner">
                <div class="item-title">朕查阅的</div>
                <div class="item-after itm-buy">30</div>
              </div>
            </li>
            <li class="item-content item-link" data-href="#share">
              <div class="before-media"><i class="iconfont icon-myshare"></i></div>
              <div class="item-media"><i class="icon icon-f7"></i></div>
              <div class="item-inner">
                <div class="item-title">朕分享的</div>
                <div class="item-after item-share">0</div>
              </div>
            </li>
            <li class="item-content item-link item-content-new" data-href="#new" style="display:none">
              <div class="before-media"><i class="iconfont icon-new"></i></div>
              <div class="item-media"><i class="icon icon-f7"></i></div>
              <div class="item-inner">
                <div class="item-title">最新美食</div>
              </div>
            </li>
          </ul>

          <ul class="">
            <li class="item-content item-link item-share">
              <div class="before-media"><i class="iconfont icon-invite"></i></div>
              <div class="item-media"><i class="icon icon-f7"></i></div>
              <div class="item-inner">
                <div class="item-title">邀请爱卿使用</div>
              </div>
            </li>
            <li class="item-content item-link item-message" data-href="http://form.mikecrm.com/Qg7fK7">
              <div class="before-media"><i class="iconfont icon-feedback"></i></div>
              <div class="item-media"><i class="icon icon-f7"></i></div>
              <div class="item-inner">
                <div class="item-title">给小问子提意见</div>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="modal-overlay modal-overlay-visible" style="display:none;"></div>
    <div class="modal modal-in model-share" style="display: none; margin-top: -72px;">
      <img class="invite-img" src="/img/invite.png">
    </div>

    <div class="modal modal-in model-tip" style="display: none; margin-top: -72px;">
      <div class="tip-content">
        <div class="tip-content-title">计费说明</div>
        <div class="tip-content-li">
          <div>1)&nbsp;&nbsp;&nbsp;收益来源于你分享的内容，你可以设定每条信息的查看价格，其他人查看，需要付费。</div>
        </div>
        <div class="tip-content-li">
          <div>2)&nbsp;&nbsp;&nbsp;收入扣除10%为收益，每天早9点自动入库微信钱包，但低于1元不入库。</div>
        </div>
        <div class="tip-content-get">朕知道了</div>
      </div>
    </div>

    <div class="wenwo-logo-content">
      <img src="/img/wenwo.svg" class="wenwo-logo" alt="">
      <div class="wenwo-title">
        让经验帮你赚钱
      </div>
    </div>
  </div>

  <nav class="bar bar-tab">
    <a class="tab-item find active" data-type="find" href="#">
      <span class="icon iconfont icon-faxian-empty"></span>
      <span class="tab-label">发现</span>
    </a>
    <a class="tab-item edit" data-type="edit" href="#">
      <!-- <span class="icon iconfont icon-bianji"></span>
      <span class="tab-label">发布</span> -->
      <img src="/img/food/send.svg" alt="" class="send-button">
    </a>
    <a class="tab-item like" data-type="like" href="#">
      <span class="icon icon-likeEat"></span>
      <span class="tab-label">想吃</span>
    </a>
  </nav>
  <div class="dialog-buy">
    <div class="modal-overlay modal-overlay-visible"></div>
    <div class="modal">
      <div class="modal-inner">
        <div class="modal-title">小问提醒</div>
        <div class="modal-text">123</div>
      </div>
      <div class="modal-buttons ">
        <span class="modal-button modal-button-cancel">取消</span>
        <span class="modal-button modal-button-bold">确定</span>
      </div>
    </div>
  </div>

  <!-- 这里是所有的最新美食列表 -->
  <div class="wenwo-content page" id='new'>
    <header class="bar bar-nav">
      <a class="button button-link button-nav pull-left back" href="#">
        <span class="icon icon-left"></span>
      </a>
      <h1 class="title">最新美食</h1>
    </header>
    <!-- 这里是所有的信息列表 -->
    <div class="new-content content pull-to-refresh-content infinite-scroll infinite-scroll-bottom" data-ptr-distance="55" data-distance="100">
      <!-- 默认的下拉刷新层 -->    
      <div class="pull-to-refresh-layer">
        <div class="preloader-tip">刷新成功</div>
        <div class="preloader"></div>
        <div class="pull-to-refresh-arrow"></div>
      </div>
      <div class="wenwo-ul">
      </div>
      <div class="infinite-scroll-preloader" >
        <div class="preloader"></div>
        <div class="ask-end" style="display:none">启禀陛下，您已经到底了。</div>
      </div>
    </div>
  </div>

  <!-- 这里是所有的最新美食列表 -->
  <div class="wenwo-content page" id='tag'>
    <header class="bar bar-nav">
      <a class="button button-link button-nav pull-left back" href="#">
        <span class="icon icon-left"></span>
      </a>
      <h1 class="title"></h1>
    </header>
    <!-- 这里是所有的信息列表 -->
    <div class="tag-content content pull-to-refresh-content infinite-scroll infinite-scroll-bottom" data-ptr-distance="55" data-distance="100">
      <!-- 默认的下拉刷新层 -->    
      <div class="pull-to-refresh-layer">
        <div class="preloader-tip">刷新成功</div>
        <div class="preloader"></div>
        <div class="pull-to-refresh-arrow"></div>
      </div>
      <div class="wenwo-ul">
      </div>
      <div class="infinite-scroll-preloader" >
        <div class="preloader"></div>
        <div class="ask-end" style="display:none">启禀陛下，您已经到底了。</div>
      </div>
    </div>
  </div>

  <!-- 这里是所有的美食攻略列表 -->
  <div class="wenwo-content page" id='strategy'>
    <header class="bar bar-nav">
      <a class="button button-link button-nav pull-left back" href="#">
        <span class="icon icon-left"></span>
      </a>
      <h1 class="title">美食攻略</h1>
    </header>
    <!-- 这里是所有的信息列表 -->
    <div class="strategy-content content pull-to-refresh-content infinite-scroll infinite-scroll-bottom" data-ptr-distance="55" data-distance="100">
      <!-- 默认的下拉刷新层 -->    
      <div class="pull-to-refresh-layer">
        <div class="preloader-tip">刷新成功</div>
        <div class="preloader"></div>
        <div class="pull-to-refresh-arrow"></div>
      </div>
      <div class="wenwo-ul strategy-ul">
      </div>
      <div class="infinite-scroll-preloader" >
        <div class="preloader"></div>
        <div class="ask-end" style="display:none">启禀陛下，您已经到底了。</div>
      </div>
    </div>
  </div>
  
  <!-- 这里是所有的精选美食卡片 -->
  <div class="wenwo-content page" id='card'>
    <header class="bar bar-nav">
      <a class="button button-link button-nav pull-left back" href="#">
        <span class="icon icon-left"></span>
      </a>
      <h1 class="title">精选美食卡片</h1>
    </header>
    <!-- 这里是所有的信息列表 -->
    <div class="card-content content pull-to-refresh-content infinite-scroll infinite-scroll-bottom" data-ptr-distance="55" data-distance="100">
      <!-- 默认的下拉刷新层 -->    
      <div class="pull-to-refresh-layer">
        <div class="preloader-tip">刷新成功</div>
        <div class="preloader"></div>
        <div class="pull-to-refresh-arrow"></div>
      </div>
      
      <!-- Slider -->
        <div class="swiper-container" data-space-between='10' data-autoplay-disable-on-interaction='false'>
          <div class="swiper-wrapper">
          </div>
        </div>

        <div class="card-li-footer">
          <div class="card-footer-li left">
            <!-- <label class="iconfont icon-likeEat"></label> -->
            <label class="card-look-food">查看美食</label>
          </div>
          <div class="card-footer-li right card-down">
            <label class="iconfont icon-xiazai"></label>
            <div class="card-down-num">-</div>
          </div>
          <div class="card-footer-li right card-like">
            <label class="iconfont icon-guanzhu"></label>
            <div class="card-like-num">-</div>
          </div>
        </div>

      <div class="wenwo-ul card-ul">

        <img src="http://o83np3eq2.bkt.clouddn.com/wenwo/1471255801394/苍蝇馆子.jpg" alt="" class="myImage" style="display:none">

        <!-- <canvas class="card-li" id="myCanvas">
        </canvas> -->
      </div>
      <div class="infinite-scroll-preloader" >
        <div class="preloader"></div>
        <div class="ask-end" style="display:none">启禀陛下，您已经到底了。</div>
      </div>
    </div>
  </div>

  <!-- 这里是所有的分类查找列表 -->
  <div class="wenwo-content page" id='tagfind'>
    <header class="bar bar-nav">
      <a class="button button-link button-nav pull-left back" href="#">
        <span class="icon icon-left"></span>
      </a>
      <h1 class="title">分类查找</h1>
    </header>
    <!-- 这里是所有的信息列表 -->
    <div class="tagfind-content content pull-to-refresh-content infinite-scroll infinite-scroll-bottom" data-ptr-distance="55" data-distance="100">
      <!-- 默认的下拉刷新层 -->    
      <div class="pull-to-refresh-layer">
        <div class="preloader-tip">刷新成功</div>
        <div class="preloader"></div>
        <div class="pull-to-refresh-arrow"></div>
      </div>
      <div class="wenwo-ul">
      </div>
      <div class="infinite-scroll-preloader" >
        <div class="preloader"></div>
        <div class="ask-end" style="display:none"></div>
      </div>
    </div>
  </div>

  <canvas id="downImg" width="300" height="400" style="display:none"></canvas>
</body>
<% include footer.ejs %>
<script type='text/javascript' src='/js/extend.js' charset='utf-8'></script>
<script type='text/javascript' src='/js/sm-extend.min.js' charset='utf-8'></script>
<!-- <script type='text/javascript' src='/js/sm.js' charset='utf-8'></script> -->
<script>
  //初始化幻灯片
  // $(function() {
  //   $(".swiper-container").swiper({
  //     speed: 400,
  //     autoplay: 3000,
  //     loop:true,
  //     autoplayDisableOnInteraction:false
  //   });
  // });


  //用户名
  var UserName = "<%= username %>";
  var CARDSWIPER;
  function initTop(){
    // var topNum = localStorage.top;
    // if(topNum){
    //   $("#"+typ+" .find-content").scrollTop(topNum);
    // }
    var findTop = localStorage.findTop;
    var likeTop = localStorage.likeTop;
    var shareTop = localStorage.shareTop;
    var buyTop = localStorage.buyTop;
    if(findTop){
      $("#find .find-content").scrollTop(findTop);
    }
    if(likeTop){
      $("#like .like-content").scrollTop(likeTop);
    }
    if(shareTop){
      $("#share .share-content").scrollTop(shareTop);
    }
    if(buyTop){
      $("#buy .buy-content").scrollTop(buyTop);
    }
  }
  var date = new Date();
  $(".nav-list-day .nav-icon label").text(formatDate("d",date));


  // var c = document.getElementById("myCanvas");
  // var ctx = c.getContext("2d");
  // // var img = $(".myImage")[0];
  // var img = new Image();
  // // img.setAttribute('crossOrigin', 'anonymous');
  // img.crossOrigin = "Anonymous";
  // img.src = 'http://o83np3eq2.bkt.clouddn.com/wenwo/1471255801394/苍蝇馆子.jpg';
  
  // var cwidth = c.width;
  // var cheight = c.height;
  // ctx.fillText("Hello World!",10,50);
  // // ctx.drawImage(img, 0, 0,cwidth,cheight/2);
  // img.onload = function() {
  //   ctx.drawImage(img, 0, 0,cwidth,cheight/2);
  // };

  $(".icon-xiazai").on("click",function(){
    var id = $("#card .swiper-slide-active").attr("data-id");
    var cardImg = $("#card .swiper-slide-active .card-img").attr("data-url");
    var detail = $("#card .swiper-slide-active .card-detail").text();
    var cardBy = $("#card .swiper-slide-active .card-by").text();

    console.log(detail);
    var c = document.getElementById("downImg");
    var ctx = c.getContext("2d");
    ctx.fillStyle="#ffffff";
    ctx.fillRect(0,0,300,400);

    var img = new Image();
    img.crossOrigin = "Anonymous";
    img.src = cardImg;

    var cwidth = c.width;
    var cheight = c.height;

    ctx.textAlign="left";
    ctx.font=".74rem Arial";
    // ctx.fillText(detail,16,220);

    var black=ctx.createLinearGradient(0,0,c.width,0);
    black.addColorStop("0","black");
    black.addColorStop("0.5","black");
    black.addColorStop("1.0","black");
    // 用渐变填色
    ctx.fillStyle=black;

    console.log(ctx.measureText(detail).width);

    var lineheight = 22;
     function getTrueLength(str){//获取字符串的真实长度（字节长度）
            var len = str.length, truelen = 0;
            for(var x = 0; x < len; x++){
                if(str.charCodeAt(x) > 128){
                    truelen += 2;
                }else{
                    truelen += 1;
                }
            }
            return truelen;
        }
        function cutString(str, leng){//按字节长度截取字符串，返回substr截取位置
            var len = str.length, tlen = len, nlen = 0;
            for(var x = 0; x < len; x++){
                if(str.charCodeAt(x) > 128){
                    if(nlen + 2 < leng){
                        nlen += 2;
                    }else{
                        tlen = x;
                        break;
                    }
                }else{
                    if(nlen + 1 < leng){
                        nlen += 1;
                    }else{
                        tlen = x;
                        break;
                    }
                }
            }
            return tlen;
        }
    for(var i = 1; getTrueLength(detail) > 0; i++){
      var tl = cutString(detail, 37);
      ctx.fillText(detail.substr(0, tl).replace(/^\s+|\s+$/, ""), 16, i * lineheight + 220);
      detail = detail.substr(tl);
    }
    if(getTrueLength(detail) <= 0){
      ctx.fillText(cardBy, 300-16-ctx.measureText(cardBy).width, (i+1) * lineheight + 230);
    }

    //设置logo
    // var logo = new Image();
    // logo.src = $(".wenwo-logo").attr("src");
    // ctx.drawImage(logo,20,370,10,10);
    ctx.font="10px Arial";
    var gradient=ctx.createLinearGradient(0,0,c.width,0);
    gradient.addColorStop("0","#aaa");
    gradient.addColorStop("1.0","#ccc");
    // 用渐变填色
    ctx.fillStyle=gradient;
    ctx.fillText("来自问我—让经验帮你赚钱",20,385);

    img.onload = function() {

      //图片居中算法
      var imgHeight = img.naturalHeight;
      var imgWidth = img.naturalWidth;
      console.log(imgWidth + "----"+imgHeight);
      var canvasHeight = 200;
      var canvasWidth = 300;

      var sx = 0,
          sy = (imgHeight - imgWidth * (canvasHeight / canvasWidth))/2,
          swidth = imgWidth,
          sheight = imgWidth * (canvasHeight / canvasWidth),
          x = 0,
          y = 0,
          width = canvasWidth,
          height = canvasHeight;

      ctx.drawImage(img,0,sy,swidth,sheight,x,y,300,200);
      // window.location.href = c.toDataURL("image/png");
      // window.location.href = c.toDataURL("image/png").replace("image/png", "image/octet-stream");
      var timestamp = new Date().getTime();
      downloadFile("wenwo"+timestamp+'.png', c.toDataURL("image/png"));

      //将人数加1
      var downNum = parseInt($(".card-down-num").text());
      downNum++;
      $(".card-down-num").text(downNum);
      var cardId = $("#card .swiper-slide-active").attr("data-id");
      addDownNum(cardId,{
        success:function(){
          console.log("success");
        },
        error:function(){

        }
      })
    };
    
  })

  //浏览人数添加
  function addDownNum(cardId,callback){
    $.ajax({
      type: "POST",
      url: "/card/addDownNum",
      data: {card_id:cardId},
      dataType: "json",
      success:function(result){
        if(result.code == 200){
          callback.success(result);
        }else{
          callback.error(result);
        }
      },
      error:function(error){
        $.toast("服务器出错");
        callback.error(error);
      }
    })
  }

  function base64Img2Blob(code){
    var parts = code.split(';base64,');
    var contentType = parts[0].split(':')[1];
    var raw = window.atob(parts[1]);
    var rawLength = raw.length;

    var uInt8Array = new Uint8Array(rawLength);

    for (var i = 0; i < rawLength; ++i) {
      uInt8Array[i] = raw.charCodeAt(i);
    }

    return new Blob([uInt8Array], {type: contentType}); 
  }

  function downloadFile(fileName, content){            
    var aLink = document.createElement('a');
    var blob = base64Img2Blob(content); //new Blob([content]);
                
    var evt = document.createEvent("HTMLEvents");
    evt.initEvent("click", false, false);//initEvent 不加后两个参数在FF下会报错
    aLink.download = fileName;
    aLink.href = URL.createObjectURL(blob);
           
    aLink.dispatchEvent(evt);
  }

  $("#card .swiper-wrapper").bind("touchend",function(){
    setTimeout(function(){
      var cardId = $("#card .swiper-slide-active").attr("data-id");
      var likeNum = $("#card .swiper-slide-active").attr("data-like-num");
      var downNum = $("#card .swiper-slide-active").attr("data-down-num");
      var liked = $("#card .swiper-slide-active").attr("data-liked");
      $(".card-li-footer").attr("data-cardId",cardId);
      $(".card-down-num").text(downNum);
      $(".card-like-num").text(likeNum);
      if(liked == "1"){
        $(".card-like").addClass("card-liked");
      }else{
        $(".card-like").removeClass("card-liked");
      }
    }, 100);
  })

  //卡片点击想吃逻辑
  $(".card-like").on("click", function() {
      //获取点击后的id
      var askId = $("#card .swiper-slide-active").attr("data-askid");
      var num = $(".card-like-num").text();
      //获取是否是已想吃
      if ($(this).hasClass("card-liked")) {
          //已经是想吃的    取消想吃
          num = parseInt(num) - 1;
          $(".card-like-num").text(num);
          $(".card-like").removeClass("card-liked");
          cancelLike(UserName, askId, this, {
              success: function(result, $_this) {
                  if (result.code == 200) {

                  } else {
                      num++;
                      $(".card-like-num").text(num);
                      $(".card-like").addClass("card-liked");
                  }
              },
              error: function(error, $_this) {
                  num++;
                  $(".card-like-num").text(num);
                  $(".card-like").addClass("card-liked");
              }
          });
      } else {
          //想吃
          num = parseInt(num) + 1;
          $(".card-like-num").text(num);
          $(".card-like").addClass("card-liked");
          like(UserName, askId, this, {
              success: function(result, $_this) {
                  console.log(result);
                  if (result.code == 200) {} else {
                      num--;
                      $(".card-like-num").text(num);
                      $(".card-like").removeClass("card-liked");
                  }
              },
              error: function(error, $_this) {
                  console.log(error);
                  num--;
                   $(".card-like-num").text(num);
                  $(".card-like").removeClass("card-liked");
              }
          });
      }
  })

</script>
<script type='text/javascript' src='/js/newfood.js' charset='utf-8'></script>
</html>