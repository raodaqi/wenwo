<!DOCTYPE HTML>
<html>
<head>
  <meta charset='utf-8'>
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <meta name='description', content='wenwo,问我,当地人,旅游,攻略,信息,分享,经验,赚钱，美食，成都，好吃'>
  <meta name='author', content='raodqi'>
  <link rel="icon" type="image/x-icon" href="/img/logo.jpg" media="screen">
  <title>问我-让经验帮你赚钱</title>
  <link rel="stylesheet" href="/css/sm.min.css">
  <link rel="stylesheet" href="http://at.alicdn.com/t/font_1468915240_5629373.css">
  <link rel="stylesheet" href="/css/style.css">
  <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=cb84c659c88a7cc83b935a009b3a9cfd&plugin=AMap.Walking"></script>
</head>
  <style>
    html{
      font-size: 20px;
    }
    body{
      position: absolute;
      left: 0;
      right: 0 !important;
      padding:0;
      margin:0;
      width: 100%;
      overflow: hidden;
      background-color: #E8E8E8;
    }
    #container{
      width: 100%;
      height: 100%;
    }
    .iconfont {
      font-family: "iconfont" !important;
    }
    #panel {
      position: fixed;
      background-color: white;
      max-height: 90%;
      overflow-y: auto;
      top: 10px;
      right: 10px;
      width: 280px;
      display: none;
    }
  </style>
<body>
  <div class="wenwo-content page page-current" id='find'>
    <header class="bar bar-nav">
      <a class="button button-link button-nav pull-left back">
        <span class="icon iconfont icon-zuo"></span>
      </a>
      <h1 class="title">地图</h1>
    </header>
    <div id="container"></div>
    <div id="panel"></div>
  </div>
</body>
  <script type='text/javascript' src='/js/zepto.min.js' charset='utf-8'></script>
  <script type="text/javascript" src="/js/common.js"></script>
  <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
  <script type="text/javascript" src="/js/wxlocation.js"></script>
  <script>
  $(".back").on("click",function(){
    window.history.back(-1);
  })
  $.showPreloader("正在加载");
  var marker;
  var icon = new AMap.Icon({
    image: "/img/edit/marker.png",
  });
  var lat = "<%= lat %>";
  var lng = "<%= lng %>";
  if(lat && lng){
    //详情地点显示
    map = new AMap.Map('container', {
      resizeEnable: true,
      zoom:13,
      center: [lng,lat]
      // buttonDom:'<div class="geolocation-position"><img src="/img/position.png"></div>',
      // buttonOffset: new AMap.Pixel(20, 25),//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
      // zoomToAccuracy: true,      //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
      // buttonPosition:'LB',
      // showCircle:false,
      // useNative:true
    });

    map.plugin(["AMap.ToolBar"], function() {
      map.addControl(new AMap.ToolBar());
    });

     // var walking = new AMap.Walking({
     //    map: map,
     //    panel: "panel"
     //  }); 
     //  walking.search([104.181371,30.817972],[lng,lat],function(status,result){
     //    console.log(result);
     //  });
  }

  if(navigator.geolocation) { // 判断设备是否支持定位
  　　navigator.geolocation.getCurrentPosition(function(position) { 　　
        //步行导航
        var myLng = position.coords.longitude;
        var myLat = position.coords.latitude;
        var walking = new AMap.Walking({
            map: map,
            panel: "panel"
        }); 
        $.hidePreloader();
        walking.search([myLng,myLat],[lng,lat],function(status,result){
          console.log(result);
        });
  　　}, function(error) {
          initLocation({
            success:function(myLng,myLat){
              $.hidePreloader();
              if(myLng && myLat){
                //步行导航
                var walking = new AMap.Walking({
                    map: map,
                    panel: "panel"
                }); 
                walking.search([myLng,myLat],[lng,lat],function(status,result){
                  console.log(result);
                });
              }else{
                marker = new AMap.Marker({
                  map : map,
                  icon : icon,
                  position: [lng,lat],
                  draggable: false,
                  cursor: 'move',
                  raiseOnDrag: false,
                  clickable:false
                });
                marker.setMap(map);
              }
            }
          });
  　　}, {
  　　　　maximumAge: 0
  　　});
　　}else {
　　　　initLocation({
          success:function(myLng,myLat){
            $.hidePreloader();
            if(myLng && myLat){
              //步行导航
              var walking = new AMap.Walking({
                  map: map,
                  panel: "panel"
              }); 
              walking.search([myLng,myLat],[lng,lat],function(status,result){
                console.log(result);
              });
            }else{
              marker = new AMap.Marker({
                map : map,
                icon : icon,
                position: [lng,lat],
                draggable: false,
                cursor: 'move',
                raiseOnDrag: false,
                clickable:false
              });
              marker.setMap(map);
            }
          }
        });
　　}
  </script>
</html>