<!DOCTYPE HTML>
<html>
<head>
    <title>WenWo</title>
     <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta name='description', content='wenwo,问我,当地人,旅游,攻略,信息,分享'>
    <meta name='author', content='raodqi'>
    <link rel="icon" type="image/x-icon" href="/img/logo.png" media="screen">
    <title>问我——像个当地人一样去旅游</title>
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_1462821367_1895313.css">
    <link rel="stylesheet" href="/css/sm.min.css">
    <link rel="stylesheet" href="/css/common.css">
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=cb84c659c88a7cc83b935a009b3a9cfd&plugin=AMap.Geocoder"></script>
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <!-- <link rel="stylesheet" href="/css/bootstrap.min.css"> -->
</head>
<style>
    * {
        padding: 0;
        margin: 0;
    }
    li {
        list-style-type: none;
        cursor: pointer;
    }
    .wrap {
        margin: 0 auto;
        width: 1200px;
    }
    .title-bar {
        height: 60px;
        background: #f8bd38;
        border-radius: 5px;
    }
    .logo {
        color: #fff;
        font-size: 23px;
        line-height: 60px;
        margin-left: 20px;
    }
    .list {
        float: left;
        margin-top: 30px;
        margin-left: 30px;
    }
    .side-bar {
        width: 200px;
        /*background: #000;*/

    }
    .side-bar ul {
        /*border-radius: 10px;*/
        overflow: hidden;
    }
    .side-bar ul li {
        /*margin-bottom: 10px;*/
        text-align: center;
        height: 40px;
        font-size: 18px;
        line-height: 40px;
        background: #eee;
        margin:10px; 
       /* padding-top: 10px;
        padding-bottom: 10px;*/
    }
    ul li:hover {
        /*background: #ddd !important;*/
        background: #f8bd38 !important;
        color: white;
    }
    .manage-content {
        background: #eee;
        width: 880px;
        border-radius: 10px;
        overflow: hidden;
        padding: 20px 20px 20px 20px;
    }
    .manage ul li {
        display: block;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    .manage ul li .ask-id {
        display: inline;
        margin-left: 30px;
        line-height: 20px;
        /*width: 90%;*/
    }
    .manage ul li .staus, .manage ul li .del {
        float: right;
        line-height: 20px;
        /*clear: both;*/
        margin-right: 30px;
    }
    .manage ul li .del:hover {
        color: red;
    }
    .check li {
        padding: 10px 0;
        font-size: 20px;
        text-align: center;

    }
    .side-bar-back{
        background: #eee !important;
    }
    .side-bar-backcheck {
        background: #f8bd38 !important;
        color: white;
    }
    .btn_pass, .btn_not, .btn_send,.btn_down,.btn_edit,.btn_add,.btn_save,.btn_delete{
        margin: 0;
        margin-top: 20px;
        font-size: 16px;
        color: white;
        border-radius: 5px;
        padding: 0;
        width: 100px;
        height: 40px;
        background: #f8bd38;
        border: none;
    }
    .btn_add{
        background: #6ed56c;
        margin-right: .5rem; 
    }
    .btn_save{
        background-color: #008be7;
    }
    .btn_delete{
        background-color: #f74b46;
        margin-left: .5rem; 
    }
    textarea {
        display: block;
        height: 100px;
        width: 300px;
    }
    .input-edit,#search {
        height: 30px;
        width: 240px;
        padding: 0 10px 0 10px;
        font-size: 15px;
        /*border-radius: 2px;
        border: none;
        box-shadow: none;
        outline: none;
        background-color: transparent;
        padding-left: 10px;
        margin-left: 10px;
        text-transform: lowercase;
        background-color: white;*/
    }
    .input-price {
        text-align: left;
    }
    .container-show{
        height: 400px;
        width: 400px;
        background-color: white;
    }
    .left{
        float: left;
        margin-right: 10px;
    }
    .hidden-text{
        color: red;
    }
    .de-show{
        padding:10px;
        font-size: 15px; 
        width: 300px;
    }
    .place{
        color: red;
        font-size: 15px;
        /*width: 300px;*/
        padding-left: 10px;
        line-height: 30px;
    }
    .check-box label{
        margin-right: 10px;
    }
    .check-box,.div-tag,.div-reason{
        margin-bottom: 10px;
    } 
    .type-item {
        display: inline-block;
        padding: 0px 20px;
        /* color: #FFC222; */
        /* background-color: #FFDC7F; */
        height: 30px;
        line-height: 30px;
        font-weight: 400;
        font-size: 15px;
        text-align: center;
        margin: 0 .5rem .2rem 0;
        border-radius: 3px;
        border: 1px solid #393e49;
    }
    .edit-reason,.edit-detail{
        font-size: 15px;
        padding: 10px;
        border-radius: 10px;
    }
    .button-start{
        display: inline-block;
        text-align: center;
        font-size: 15px;
        color: white;
        width: 100px;
        margin: 10px auto;
        height: 30px;
        line-height: 30px;
        border-radius: 5px;
        background-color: #efc553 !important;
        cursor: pointer;
        margin-left: 100px;
    }
    .edit-detail{
        height: 200px;
    }
    #search{
        width: 400px;
        display: block;
    } 
    body{
        overflow: auto;
    }
    .address-content{
        /*float: left;*/
        margin-bottom: 10px;
    }
    .amap-sug-result{
        top:213px !important;
    }
    .geolocation-position img{
        width: 40px;
        height: 40px;
    }
    .modal-overlay{
        display: none !important;
    }
    .modal-inner{
        background: rgba(0,0,0,.8);
        color: white;
    }
    .notpass{
        color: #B9B9B9;
    }
    .pass{
        color: #4CAF50;
        font-weight: bolder;
    }
    .tag-li-list{
        /*height: 80px;*/
        /*line-height: 100px;*/
        /*display: inline-block;*/
        float: left;
        width: 200px;
        text-align: center;
        font-size: 18px;

    }
    .tag-img,.tag-tag,.tag-type,.add-img{
        width: 80px;
        height: 80px;
        cursor: pointer;
    }
    .tag-tag,.tag-type{
        width: 200px;
        text-align: center;
        line-height: 80px;
    }
    .content-title.tag li{
        width: 100%;
    }
    .content-title.tag ul li:hover {
        color: black !important;
    }
    .list-img{
        width: 100px;
    }
    #multiple{
        display: none;
    }
    .modal-text-input{
        color: black;
    }
    .modal-button{
        background: rgba(0,0,0,.8);
    }
    .send-img{
        height: 80px;
        line-height: 80px;
        margin-bottom: 10px;
    }
    .send-img img{
        margin-left: 10px;
    }
    .send-img label{
        display: block;
        float: left;
        height: 80px;
    }
    .send-num{
        margin:20px 0 10px 0;
    }
    .send-content-li{
        padding-bottom: 1.5rem;
        border-bottom: 1px solid #ccc;
        margin-top: 1rem;
    }
    .send-url input{
        width: 25rem;
    }
    .carouse-num{
        width: 2.5rem;
        text-align: center;
    }
    .carousel-content-tip{
        color: #008be7;
        background: #f4faff;
        /*border-color: #4eb9ff;*/
        padding:.6rem;
        border-left: .5rem solid #4eb9ff;
        font-size: .72rem;
    }
    .carouse-show{
        margin-left: .5rem;
        margin-right: .3rem;
        color: #000000;
        font-size: .82rem;
    }
    .send-name{
        margin: .3rem 0;
    }
    .preloader-modal{
        position: fixed;
        bottom:0;
    }
    .red{
        color: #f74b46;
    }
</style>
<body>
    <div class="wrap">
        <div class="title-bar">
            <div class="logo" id="logo">WenWo</div>
        </div>
        <div>
            <div class="list side-bar">
                <ul>
                    <li class="send-bar side-bar-backcheck">轮播图管理</li>
                    <li class="check-bar">审核信息</li>
                    <li class="manage-bar">管理消息</li>
                    <li class="tag-bar">标签管理</li>
                    <li class="total-bar">提现管理</li>
                    <li class="account-bar">帐号管理</li>
                </ul>
            </div>
            <div class="list manage-content">
                <div class="content-title send" style="display: block">
                <div class="carousel-content-tip">图片，是否显示按钮点击后不会自动保存，需要点击保存才会保存，图片最好先压缩下才上传。<a target="_black" href="https://tinypng.com" class="red">图片压缩网站</a></div>
                    <div class="send-content-ul">
                    </div>
                    <button class='btn_add'>添加</button>
                </div>

                <div class="content-title check" style="display: none">
                    <ul>
                        <!--<li>234567893456789</li>-->
                        <!--<li>234567893456789</li>-->
                        <!--<li>234567893456789</li>-->
                    </ul>
                </div>
                <div class="content-title check-detail" style="display: none">
                    <div>
                        <div class="left">ID:</div>
                        <div class="detail-id"></div>
                    </div>
                    <div>
                        <div class="left">上传者:</div>
                        <div class="detail-createBy"></div>
                    </div>
                    <div>
                        <div class="left">上传时间:</div>
                        <div class="detail-time"></div>
                    </div>
                    <div>
                        <div class="left">状态:</div>
                        <div class="detail-status"></div>
                    </div>
                    <div>
                        <div class="left">主题:</div>
                        <div class="detail-subject"></div>
                    </div>
                    <div>
                        <div class="left">标签:</div>
                        <div class="detail-label"></div>
                    </div>
                    <div>
                        <div class="left">推荐理由:</div>
                        <div class="detail-reason"></div>
                    </div>
                    <div>
                        <div class="left">详情(红色为隐藏部分):</div>
                        <div class="detail-information"></div>
                    </div>
                    <div>
                        <div>地图标注:</div>
                        <div class="add-detail"></div>
                        <div class="container-show" id="show2"></div>
                    </div>
                    <div>
                        <div class="left">价格:</div>
                        <div class="detail-price"></div>
                    </div>
                    <div class="check-button">
                        <button class='btn_pass'>通过</button>
                        <button class='btn_not'>不通过</button>
                    </div>
                    <div class="down" style="display:none">
                        <button class='btn_down'>下架</button>
                        <button class='btn_edit'>编辑</button>
                    </div>
                </div>

                <div class="content-title total" style="display: none">
                    <ul>
                        <!-- <li><span class="ask-id">456789adf</span><span class="del">X</span><span class="staus">已上架</span></li> -->
                        <!--<li><span class="ask-id">456789adf</span><span class="del">X</span><span class="staus">已上架</span></li>-->
                        <!--<li><span class="ask-id">456789adf</span><span class="del">X</span><span class="staus">已上架</span></li>-->
                        <!--<li><span class="ask-id">456789adf</span><span class="del">X</span><span class="staus">已上架</span></li>-->

                    </ul>
                </div>
                <div class="content-title manage" style="display: none">
                    <ul>
                        <!--<li><span class="ask-id">456789adf</span><span class="del">X</span><span class="staus">已上架</span></li>-->
                        <!--<li><span class="ask-id">456789adf</span><span class="del">X</span><span class="staus">已上架</span></li>-->
                        <!--<li><span class="ask-id">456789adf</span><span class="del">X</span><span class="staus">已上架</span></li>-->
                        <!--<li><span class="ask-id">456789adf</span><span class="del">X</span><span class="staus">已上架</span></li>-->

                    </ul>
                </div>
                <div class="content-title tag" style="display: none">
                    <ul>
                        <li>
                            <div class="tag-li-list">二级标签名</div>
                            <div class="tag-li-list">所属一级标签</div>
                            <div class="tag-li-list list-img">无</div>
                            <div class="tag-li-list list-img">青铜</div>
                            <div class="tag-li-list list-img">白银</div>
                            <div class="tag-li-list list-img">黄金</div>
                        </li>
                        <div class="tag-list-content">
                            
                        </div>
                        <!-- <li>
                            <div class="tag-li-list">
                                <div class="tag-tag">火锅</div>
                            </div>
                            <div class="tag-li-list">
                                <div class="tag-type">美食,出行</div>
                            </div>
                            <div class="tag-li-list list-img img1">
                                <img class="tag-img" src="/img/test.jpg" alt="">
                            </div>
                            <div class="tag-li-list list-img img2">
                                <img class="tag-img" src="/img/test.jpg" alt="">
                            </div>
                            <div class="tag-li-list list-img img3">
                                <img class="tag-img" src="/img/test.jpg" alt="">
                            </div>
                            <div class="tag-li-list list-img img4">
                                <img class="tag-img" src="/img/test.jpg" alt="">
                            </div>
                        </li>

                        <li>
                            <div class="tag-li-list">
                                <div class="tag-tag">火锅</div>
                            </div>
                            <div class="tag-li-list">
                                <div class="tag-type">美食,出行</div>
                            </div>
                            <div class="tag-li-list list-img img1">
                                <img class="tag-img" src="/img/test.jpg" alt="">
                            </div>
                            <div class="tag-li-list list-img img2">
                                <img class="tag-img" src="/img/test.jpg" alt="">
                            </div>
                            <div class="tag-li-list list-img img3">
                                <img class="tag-img" src="/img/test.jpg" alt="">
                            </div>
                            <div class="tag-li-list list-img img4">
                                <img class="tag-img" src="/img/test.jpg" alt="">
                            </div>
                        </li> -->
                    </ul>
                </div>
                <div class="content-title account" style="display: none">
                    <div>
    
                    </div>
                </div>
            </div>

        </div>

        <div id="dropbox" class="dropbox" style="display:none">
        </div>

        <input id="multiple" class="hidden" type="file" id="upload" multiple>
    </div>
    <script type='text/javascript' src='/js/zepto.min.js' charset='utf-8'></script>
     <!-- <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=cb84c659c88a7cc83b935a009b3a9cfd&plugin=AMap.Geocoder"></script> -->

     <script type="text/javascript" src="/js/sm.min.js"></script>
     <script type="text/javascript" src="/js/common.js"></script>
     <script type="text/javascript" src="/js/plupload.full.min.js"></script>
     <script type="text/javascript" src="/js/qiniu.min.js"></script>
    
    <script>
        //初始化轮播图功能
        function sendCarouseQuest(url,type,data,callback){
            $.ajax({
              type: type,
              url: url,
              data: data,
              dataType: "json",
              success:function(result){
                if(result.code == 200){
                    callback.success(result);
                }else{
                    callback.error(result);
                }
              },
              error:function(error){
                $.toast("服务器出错");
                callback.error(error);
              }
          })
        }
        function getCarouselInfo(callback){
            var url = "/carousel/getcarouselinfo",
                type = "GET",
                data = {
                    type : "all"
                };
            sendCarouseQuest(url,type,data,{
                success:function(result){
                    callback.success(result);
                },
                error:function(error){
                    callback.error(error);
                }
            })
        }

        function deleteCarouselInfo(id,callback){
            var url = "/carousel/delcarouselinfo",
                type = "POST",
                data = {
                    carousel_id : id
                };
            sendCarouseQuest(url,type,data,{
                success:function(result){
                    callback.success(result);
                },
                error:function(error){
                    callback.error(error);
                }
            })
        }

        function addCarouselInfo(data,callback){
            var url = "/carousel/addcarouselinfo",
                type = "POST",
                data = data;
            sendCarouseQuest(url,type,data,{
                success:function(result){
                    callback.success(result);
                },
                error:function(error){
                    callback.error(error);
                }
            })
        }

        function editCarouselInfo(data,callback){
            var url = "/carousel/editcarouselinfo",
                type = "POST",
                data = data;
            sendCarouseQuest(url,type,data,{
                success:function(result){
                    callback.success(result);
                },
                error:function(error){
                    callback.error(error);
                }
            })
        }

        getCarouselInfo({
            success:function(result){
                console.log(result);
                var data = result.data;
                var li = '';
                for(var i = 0 ; i < data.length; i++){
                    li += '<div class="send-content-li" data-num="1" data-id="'+data[i].objectId+'" id="'+data[i].objectId+'"><div class="send-img"><label> 轮播图:</label><img class="tag-img" data-type="0" src="'+data[i].carouselImage+'" alt=""></div><div class="send-name">名字：<input class="name" type="text" value="'+(data[i].carouselName?data[i].carouselName:"")+'"></div><div class="send-url">链接：<input type="text" value="'+data[i].carouselClickURL+'"></div><button class="btn_save">保存</button><button class="btn_delete">删除</button><label class="carouse-show">是否显示</label><label class="label-switch"><input type="checkbox" '+(data[i].show ? "checked='true'" : "")+'><div class="checkbox"></div></label></div>';
                }
                $(".send-content-ul").empty().append(li);
            },
            error:function(error){
                console.log(error);
            }
        })

        $(".btn_add").on("click",function(){
            var length = $(".send-content-li").length;
            li = '<div class="send-content-li" data-num="1" data-type="add"><div class="send-img"><label> 轮播图:</label><img class="tag-img" data-type="0" src="/img/add.jpg" alt=""></div><div class="send-name">名字：<input class="name" type="text" value=""></div><div class="send-url">链接：<input type="text" value=""></div><button class="btn_save">保存</button><button class="btn_delete">删除</button><label class="carouse-show">是否显示</label><label class="label-switch"><input type="checkbox" checked="true"><div class="checkbox"></div></label></div>';
            $(".send-content-ul").append(li);
        })

        $(".send-content-ul").on("click",".btn_delete",function(){
            var id = $(this).parent().attr("data-id");
            var $parent = $(this).parent();
            console.log(id);
            if(!id){
                $parent.remove();
            }else{
                //发起删除请求
                $.confirm('你确定要删除这条数据吗?', '温馨提示',
                    function () {
                      $.showPreloader("正在删除数据");
                      deleteCarouselInfo(id,{
                        success: function(result){
                            $.hidePreloader();
                            if(result.code == 200){
                                $.toast("删除成功");
                                $parent.remove();
                            }else{
                                $.toast("删除失败");
                            }
                        },
                        error:function(error){
                            $.toast("服务器出错");
                        }
                      })
                    },
                    function () {

                    }
                );
            }
        })

    </script>

     <script>
        var TAGID = '',
            TAGTYPE = '',
            $TAG,
            TAGLEAVE = '',
            TAGNAME = '';

        var uploader = Qiniu.uploader({
            runtimes: 'html5,flash,html4',    //上传模式,依次退化
            browse_button: 'dropbox',       //上传选择的点选按钮，**必需**
            uptoken_url: '/manage/token',
            filters: {
              max_file_size : '10mb',
              mime_types : [ //只允许上传图片和zip文件
                { title : "Image files", extensions : "JPEG,jpg,gif,png" }
              ]
            },
            domain: 'http://qiniu-plupload.qiniudn.com/',
                //bucket 域名，下载资源时用到，**必需**
            max_file_size: '2048mb',           //最大文件体积限制
            flash_swf_url: 'js/plupload/Moxie.swf',  //引入flash,相对路径
            max_retries: 3,                   //上传失败最大重试次数
            chunk_size: '4mb',                //分块上传时，每片的体积
            auto_start: true,                 //选择文件后自动上传，若关闭需要自己绑定事件触发上传
            init: {
                'FilesAdded': function(up, files) {
                    $.showPreloader("正在上传");
                    plupload.each(files, function(file) {
                       var myDate=new Date();
                       time = myDate.getTime();
                       fileName = files[0].name;
                       var name = files[0].name;

                       fileName = "wenwo/"+time+"/"+fileName;

                       if(up.files.length > 1){
                        for(var i = 0; i < up.files.length - 1;i++){
                          up.removeFile(up.files[i].id);
                        }
                       }
                       console.log($TAG);
                       // previewImage(files[0],function(imgsrc){
                       //      $TAG.attr("src",imgsrc);
                       //  })
                    });
                },
                'BeforeUpload': function(up, file) {
                       // 每个文件上传前,处理相关的事情
                },
                'UploadProgress': function(up, file) {
                       // 每个文件上传时,处理相关的事情
                       // $(".squre").text(file.percent+"%");
                       $(".modal-title").text("已上传"+file.percent+"%");
                       console.log(file.percent);
                       // console.log(up);
                },
                'FileUploaded': function(up, file, info) {
                       console.log(info);
                       var res = JSON.parse(info);
                       var sourceLink = "http://o83np3eq2.bkt.clouddn.com/" + res.key; //
                       console.log(sourceLink);
                       $.hidePreloader();
                       $TAG.attr("src",sourceLink);
                },
                'Error': function(up, err, errTip) {
                       //上传出错时,处理相关的事情
                       console.log(err);
                },
                'UploadComplete': function() {
                       //队列文件处理完毕后,处理相关的事情
                },
                'Key': function(up, file) {
                    // 若想在前端对每个文件的key进行个性化处理，可以配置该函数
                    // 该配置必须要在 unique_names: false , save_key: false 时才生效
                    var key = "";
                    key = fileName;
                    // do something with key here
                    return key
                }
              }
          });

        $(".send-content-ul").on("click",".tag-img",function(){
            $TAG = $(this);
            $("#multiple,#dropbox").click();
            // uploader.start();
        })

        $(".send-content-ul").on("click",".btn_save",function(){
            //判断是否上传了图片
            var img = $(this).parent().find(".tag-img").attr("src");
            var url = $(this).parent().find(".send-url input").val();
            var name = $(this).parent().find(".send-name input").val();
            var ifAdd = $(this).parent().attr("data-type");
            var show = $(this).parent().find(".label-switch input").prop("checked") ? 1 : 0;
            var id = $(this).parent().attr("data-id");
            show  = parseInt(show);
            if(img == "/img/add.jpg"){
                $.toast("图片不能为空");
                return ;
            }
            if(!url){
                $.toast("链接不能为空");
                return ;
            }
            if(ifAdd == "add"){
                $.showPreloader("正在添加");
            }else{
                $.showPreloader("正在更改");
            }
            //新添加
            var data = {
                name     : name,
                clickURL : url,
                image    : img,
                show     : show
            }
            if(ifAdd == "add"){
                addCarouselInfo(data,{
                    success:function(result){
                        $.hidePreloader();
                        if(result.code == 200){
                            $.toast("添加成功");
                            console.log(result);
                        }else{
                            $.toast("添加失败");
                        }
                    },
                    error:function(error){
                        $.hidePreloader();
                        $.toast("服务器出错");
                    }
                })
            }else{
                //编辑
                data.id = id
                editCarouselInfo(data,{
                    success:function(result){
                        $.hidePreloader();
                        if(result.code == 200){
                            $.toast("更改成功");
                        }else{
                            $.toast("更改失败");
                        }
                    },
                    error:function(error){
                        $.toast("服务器出错");
                    }
                })
            }

        })


        // var uploader = Qiniu.uploader({
        //     runtimes: 'html5,flash,html4',    //上传模式,依次退化
        //     browse_button: 'dropbox',       //上传选择的点选按钮，**必需**
        //     uptoken_url: '/manage/token',

        //     domain: 'http://qiniu-plupload.qiniudn.com/',
        //         //bucket 域名，下载资源时用到，**必需**
        //     container: 'multiple',           //上传区域DOM ID，默认是browser_button的父元素，
        //     max_file_size: '2048mb',           //最大文件体积限制
        //     flash_swf_url: 'js/plupload/Moxie.swf',  //引入flash,相对路径
        //     max_retries: 3,                   //上传失败最大重试次数
        //     dragdrop: true,                   //开启可拖曳上传
        //     drop_element: 'create-list-logo',        //拖曳上传区域元素的ID，拖曳文件或文件夹后可触发上传
        //     chunk_size: '4mb',                //分块上传时，每片的体积
        //     auto_start: false,                 //选择文件后自动上传，若关闭需要自己绑定事件触发上传
        //     init: {
        //         'FilesAdded': function(up, files) {
        //             $(".app-logo-loading").show();
        //             plupload.each(files, function(file) {
        //                var myDate=new Date();
        //                time = myDate.getTime();
        //                fileName = files[0].name;
        //                var name = files[0].name;

        //                fileName = "wenwo/"+time+"/"+fileName;

        //                if(up.files.length > 1){
        //                 for(var i = 0; i < up.files.length - 1;i++){
        //                   up.removeFile(up.files[i].id);
        //                 }
        //                }
        //                console.log($TAG);
        //                previewImage(files[0],function(imgsrc){
        //                     $TAG.attr("src",imgsrc);
        //                     uploader.start();
        //                       // $(".app-logo-loading").hide();
        //                 })
        //             });
        //         },
        //         'BeforeUpload': function(up, file) {
        //                // 每个文件上传前,处理相关的事情
        //         },
        //         'UploadProgress': function(up, file) {
        //                // 每个文件上传时,处理相关的事情
        //                // $(".squre").text(file.percent+"%");
        //                $.showPreloader("正在提交");
        //                console.log(file.percent);
        //                // console.log(up);
        //         },
        //         'FileUploaded': function(up, file, info) {
        //                console.log(info);
        //                var res = JSON.parse(info);
        //                var sourceLink = "http://o83np3eq2.bkt.clouddn.com/" + res.key; //获取上传成功后的文件的Url
        //                console.log(sourceLink);
        //                var data = {
        //                   type      : TAGLEAVE,
        //                   level     : TAGTYPE,
        //                   tag_name  : TAGNAME,
        //                   url       : sourceLink
        //                }
        //                $.ajax({
        //                   type : "POST",
        //                   data: data,
        //                   dataType: "json",
        //                   url : "ask/edittag",
        //                   success : function(result){
        //                     $.hidePreloader();
        //                     if(result.code == 200){
        //                         $.toast("操作成功");
        //                         console.log(result);
        //                     }else{
        //                         $.toast(result.message);
        //                     }
                            
        //                   },
        //                   error:function(error){
        //                     $.hidePreloader();
        //                     $.toast("网络出错");
        //                     console.log(error);
        //                   }
        //               });

        //         },
        //         'Error': function(up, err, errTip) {
        //                //上传出错时,处理相关的事情
        //                console.log(err);
        //         },
        //         'UploadComplete': function() {
        //                //队列文件处理完毕后,处理相关的事情
        //         },
        //         'Key': function(up, file) {
        //             // 若想在前端对每个文件的key进行个性化处理，可以配置该函数
        //             // 该配置必须要在 unique_names: false , save_key: false 时才生效
        //             var key = "";
        //             key = fileName;
        //             // do something with key here
        //             return key
        //         }
        //       }
        //   });

      //plupload中为我们提供了mOxie对象
      //有关mOxie的介绍和说明请看：https://github.com/moxiecode/moxie/wiki/API
      //如果你不想了解那么多的话，那就照抄本示例的代码来得到预览的图片吧
      function previewImage(file,callback){//file为plupload事件监听函数参数中的file对象,callback为预览图片准备完成的回调函数
        if(!file || !/image\//.test(file.type)) return; //确保文件是图片
        if(file.type=='image/gif'){//gif使用FileReader进行预览,因为mOxie.Image只支持jpg和png
          var fr = new mOxie.FileReader();
          fr.onload = function(){
            callback(fr.result);
            fr.destroy();
            fr = null;
          }
          fr.readAsDataURL(file.getSource());
        }else{
          var preloader = new mOxie.Image();
          preloader.onload = function() {
            // preloader.downsize( 300, 300 );//先压缩一下要预览的图片,宽300，高300
            // preloader.downsize( 93, 93 );//先压缩一下要预览的图片,宽300，高300
            var imgsrc = preloader.type=='image/jpeg' ? preloader.getAsDataURL('image/jpeg',80) : preloader.getAsDataURL(); //得到图片src,实质为一个base64编码的数据
            callback && callback(imgsrc); //callback传入的参数为预览图片的url
            preloader.destroy();
            preloader = null;
          };
          preloader.load( file.getSource() );
        }
      }
     </script>

     <!-- <script type="text/javascript" src="/js/map.js"></script> -->
     <script>
     (function(Zepto){
            Zepto.fn.getCursorPosition = function(){
                if(this.lengh == 0) return -1;
                return $(this).getSelectionStart();
            }
            Zepto.fn.setCursorPosition = function(position){
                if(this.lengh == 0) return this;
                return $(this).setSelection(position, position);
            }
            Zepto.fn.getSelection = function(){
                if(this.lengh == 0) return -1;
                var s = $(this).getSelectionStart();
                var e = $(this).getSelectionEnd();
                return this[0].value.substring(s,e);
            }
            Zepto.fn.getSelectionStart = function(){
                if(this.lengh == 0) return -1;
                input = this[0];

                var pos = input.value.length;

                if (input.createTextRange) {
                    var r = document.selection.createRange().duplicate();
                    r.moveEnd('character', input.value.length);
                    if (r.text == '') 
                    pos = input.value.length;
                    pos = input.value.lastIndexOf(r.text);
                } else if(typeof(input.selectionStart)!="undefined")
                pos = input.selectionStart;

                return pos;
            }
            Zepto.fn.getSelectionEnd = function(){
                if(this.lengh == 0) return -1;
                input = this[0];

                var pos = input.value.length;

                if (input.createTextRange) {
                    var r = document.selection.createRange().duplicate();
                    r.moveStart('character', -input.value.length);
                    if (r.text == '') 
                    pos = input.value.length;
                    pos = input.value.lastIndexOf(r.text);
                } else if(typeof(input.selectionEnd)!="undefined")
                pos = input.selectionEnd;

                return pos;
            }
            Zepto.fn.setSelection = function(selectionStart, selectionEnd) {
                    if(this.lengh == 0) return this;
                    input = this[0];

                    if (input.createTextRange) {
                            var range = input.createTextRange();
                            range.collapse(true);
                            range.moveEnd('character', selectionEnd);
                            range.moveStart('character', selectionStart);
                            range.select();
                    } else if (input.setSelectionRange) {
                            input.focus();
                            input.setSelectionRange(selectionStart, selectionEnd);
                    }

                    return this;
            }
            Zepto.fn.insertAtCousor = function(myValue){
                var $t=$(this)[0];
                if (document.selection) {
                    this.focus();
                    sel = document.selection.createRange();
                    sel.text = myValue;
                    this.focus();
                }else if($t.selectionStart || $t.selectionStart == '0'){
                    var startPos = $t.selectionStart;
                    var endPos = $t.selectionEnd;
                    var scrollTop = $t.scrollTop;
                    $t.value = $t.value.substring(0, startPos) + myValue + $t.value.substring(endPos, $t.value.length);
                    this.focus();
                    $t.selectionStart = startPos + myValue.length;
                    $t.selectionEnd = startPos + myValue.length;
                    $t.scrollTop = scrollTop;
                }else{
                    this.value += myValue;
                    this.focus();
                }
            }
        })(Zepto);
     </script>
    <script>
        //点击下架
        $('.check-detail').on('click', ".btn_down", function () {
            //console.log('pass click');
            $.showPreloader("正在提交");
            var askId = $('.detail-id').text();
            console.log(askId);
            var data = {
                ask_id          : askId,
                username        : "wenwo",
                cancle_reason   : "error"
            }
            $.ajax({
                type: "POST",
                url: '/ask/admincancle',
                data: data,
                dataType: "json",
                success : function(result) {
                    $.hidePreloader();
                    console.log(result);
                    if (result.code == 200) {
                        $.toast("下架成功");
                        $('.check-detail').hide();
                        manageAsk();
                        $('.check').show();
                    }else{
                        $.toast(result.message);
                    }
                },
                error : function(){
                    $.hidePreloader();
                    $.toast("服务器异常");
                    console.log('err');
                }
            });
        });
    </script>
</body>
</html>
