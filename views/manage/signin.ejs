<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='utf-8'>
  <!-- <meta name='viewport', content='width=device-width, initial-scale=1.0'> -->
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <meta name='description', content='PcsCloud'>
  <meta name='author', content='raodqi'>
  <link rel="icon" type="image/x-icon" href="/img/logo.png" media="screen">
  <title>^_^享用插件|帮你更好地管理应用</title>
  <!-- link href='http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css', rel='stylesheet', type='text/css'> -->

  <link href='/css/bootstrap.min.css', rel='stylesheet', type='text/css'>
  <link href='/css/frozen.css', rel='stylesheet', type='text/css'>
<style type="text/css">
  .icon{
      display:block;
      margin:26px 30px;
      font-weight:600;
    }
  .form{
      display:block;
      margin-top:8%;
  }
  .form-container{
      display:block;
      box-sizing: border-box;
      width:80%;
      max-width:600px;
      height:50px;
      margin:24px auto;
      padding:18px 20px;
      border-radius: 5px;
  }
  .btn-content{
      background:#66afe9;
      border-color: #66afe9;
      line-height:12px;
      color:white !important;
      margin:38px auto;
  }
  .btn-content-empty{
      background:#fff;
      border-color: #66afe9;
      color:#66afe9 !important;
      line-height:12px;
  }
  .divider{
      text-align:center;
      margin-top:5%;
  }
  .divider:before,.divider:after{
      content: '';
      display: inline-block;
      vertical-align: middle;
      width: 35%;
      height: 1px;
      background-color: #BABFC3;
      margin: 0 0% 0 -50%;
  }
  .divider:after{
      margin: 0 -50% 0 0%;
    }
  .divider span{
      font-size:24px;
      padding:8px 40px;
  }
</style>
<body>

<div class="ui-loading-block show" id="loading">
    <div class="ui-loading-cnt">
        <i class="ui-loading-bright"></i>
        <p>加载中</p>
    </div>
</div>

  <a href="/" class="icon"> <i>PcsCloud</i>
  </a>
  <div>
    <div class="divider">
      <span>登录</span>
    </div>
  </div>
  <form action="/signin" method="post">
    <input placeholder="邮箱" class="form-control form-container" name="email">

    <input type="password" placeholder="密码" class="form-control form-container" name="password">

  </form>
    <button class="form-container btn btn-block btn-content" id="signin">登录</button>
  <a href="/users/signup">
    <button class="form-container btn btn-block btn-content-empty">我是新用户，我要注册</button>
  </a>
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script type="text/javascript">
  // $(window).load(function() {
  //   $("#loading").hide();
  // });
  console.log(history);
  $("#signin").on("click",function(event){

      loadingShow("正在登陆");

      var email = $("input[name=email]").val();

      var password = $("input[name=password]").val();

      if(!check("邮箱不能为空",email) || !check("密码不能为空",password)){
        return ;
      }
      var data = $("input").serialize();
        $.ajax({
          type : "POST",
          data: data,
          dataType: "json",
          url : "/signin",
          success : function(result){
            loadingHide();

            if(result.username){
              // alert("登陆成功");
              tipShow("登陆成功");
              setTimeout(function(){

                loadingShow("正在跳转");

                if(history.length > 1){
                  // window.history.go(-1);
                  location.href=document.referrer;
                }else{
                  window.location.href="<%= DOMIN %>/console";
                }
              },1000);
            }else{
              // alert(result.message);
              if(result.code == 216){
                tipShow("你的账号没有通过邮箱验证");
              }else{
                tipShow("用户名或密码错误");
              }
              
            }
          },
          error: function(error){
            loadingHide();

            tipShow("服务器挂了~~");
          }
        });
      // $("form").submit();
  })
</script>
</html>