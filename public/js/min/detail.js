onlyInitShare();console.log(UserName);if(AskId){getAskDetail(AskId,UserName)}function init(){var e=window.location.hash;if(e.split("#")[1]){URL="food"}}function getAskDetail(e,a){var a=a?a:"";var i={username:a,ask_id:e};$.ajax({type:"POST",data:i,dataType:"json",url:"/ask/askdetail",success:function(e){console.log(e);if(e.code==200){var a=e.data;$(".title").text(formatTag(a.askTagStr));$(".username").text(a.createByName);likeNum=a.likeNum<0?0:a.likeNum;$(".like-num").text(likeNum);WX_SHARE_LINK="http://www.wenwobei.com/detail?askid="+a.objectId;WX_SHARE_IMGURL=a.createByUrl;WX_SHARE_TITLE=a.askReason;console.log(WX_SHARE_TITLE);var i=a.askTagStr;i=JSON.parse(i);tag=i[0].tag_name;WX_SHARE_DESC=a.createByName+" : 分享了「"+tag+"」美食,瞅瞅波？";initShare();if(a.score<10){$(".buy").text("限时免费");$(".buy").addClass("free")}if(e.show.foodLikeFlag){$(".like").addClass("liked")}else{$(".like").removeClass("liked")}if(e.show.isOwnFlag){$(".buy").text("朕分享的");$(".buy").attr("data-buy","1")}if(e.show.havedFlag){$(".buy").text("朕已查阅");$(".buy").attr("data-buy","1");$(".buyed-img").show();$(".dislike-content").show()}if(e.show.havedFlag||e.show.isOwnFlag){if(a.shopName){$(".detail-rtname").text(a.shopName)}else{$(".detail-rtname").text("暂无")}if(a.askPosition){var t=JSON.parse(a.askPosition);var o="";for(var d in t){console.log(t[d]);if(d=="adetail"){o+="（"}o+=t[d];if(d=="adetail"){o+="）"}}$(".detail-address").text(o);$(".detail-address").attr("data-GeoX",a.GeoX);$(".detail-address").attr("data-GeoY",a.GeoY)}}$(".price").text(a.askPrice);$(".pic-bg").attr("src",a.createByUrl);$(".detail-reason").text(a.askReason);var s=a.askContentShow;if(s){if(s.indexOf("{")==-1||s.indexOf("}")==-1||s.indexOf(":")==-1){$(".detail-content").text(s)}else{s=JSON.parse(s);console.log(s);if(s.detail||s.detailLi){if(s.detail){$(".edit-detail").text(s.detail)}if(s.detailLi){console.log(s.detailLi);var l=s.detailLi;l=JSON.parse(l);$(".edit-detail-li-content").empty();for(var n=0;n<l.length;n++){var r='<div class="edit-detail-li"><div class="edit-detail-li-title">'+l[n].name+'</div><div class="edit-detail-li-input">'+l[n].val+"</div></div>";$(".edit-detail-li-content").append(r)}}}}}$(".preloader-modal").hide();$("#detail").show()}else{$(".preloader-modal").hide();$("body").empty();var c='<div class="error-content content pull-to-refresh-content" data-ptr-distance="55"><div class="pull-to-refresh-layer"><div class="preloader"></div><div class="pull-to-refresh-arrow"></div></div><div class="card-container no-user">'+e.message+"</div></div>";$("body").append(c)}},error:function(e){console.log(e);$(".preloader-modal").hide();$("body").empty();var e='<div class="error-content content pull-to-refresh-content" data-ptr-distance="55"><div class="pull-to-refresh-layer"><div class="preloader"></div><div class="pull-to-refresh-arrow"></div></div><div class="card-container no-user">服务器出错</div></div>';$("body").append(e)}})}init();$(".tab-item").on("click",function(){var e=$(this).attr("data-type");console.log(e);$(".tab-item").removeClass("active");$(this).addClass("active");if(e=="like"){$.router.load("#like")}else if(e=="find"){$.router.load("#find")}else if(e=="edit"){$.router.load("/edit?username=573c1eb271cfe4006c18274f")}});$("#detail .icon-left").on("click",function(){$.showPreloader("正在跳转");if(URL=="food"){history.back()}else{window.location.href="/food"}});$(".detail-address").on("click",function(){var e=$(this).attr("data-geox");var a=$(this).attr("data-geoy");if(e&&a){window.location.href="/map?lat="+e+"&lng="+a}});$(".content").on("click",".like",function(){var e=AskId;var a=$(".like-num").text();console.log($("liked"));if($(this).hasClass("liked")){a=parseInt(a)-1;$(".like-num").text(a);$(this).removeClass("liked");cancelLike(UserName,e,"",{success:function(e){console.log(e);if(e.code==200){}else{a++;$(".like-num").text(a);$(".like").addClass("liked")}},error:function(e){console.log(e);a++;$(".like-num").text(a);$(".like").addClass("liked")}})}else{a=parseInt(a)+1;$(".like-num").text(a);$(this).addClass("liked");like(UserName,e,"",{success:function(e){console.log(e);if(e.code==200){}else{a--;$(".like-num").text(a);$(".like").removeClass("liked")}},error:function(e){console.log(e);a--;$(".like-num").text(a);$(".like").removeClass("liked")}})}});function getHide(e){var a={username:UserName,ask_id:AskId};$.ajax({type:"POST",data:a,dataType:"json",url:"/ask/askdetail",success:function(a){console.log(a);if(a.code==200){e.success(a)}else{e.error(a)}},error:function(a){e.error(a)}})}var dislike=0;$(".right").on("click",function(){dislike=1});$(".modal-in").on("click",function(){if(dislike){}else{$(".modal-overlay-visible").hide();$(".modal-in").hide();$(".modal-dislike").hide()}dislike=0});$(".icon-tixing").on("click",function(){$(".modal-overlay-visible").show();$(".modal-tip").show()});$(".dislike-img,.dislike-text").on("click",function(){$(".modal-overlay-visible").show();$(".modal-dislike").show()});$(".dislike-right-li").on("click",function(){var e=$(this).text();$(".dislikeText").val(e)});$(".dialog-dislike-content .send").on("click",function(){var e=$(".dislikeText").val();if(!e){$.toast("你没有吐槽任何信息");return}var a={username:UserName,ask_id:AskId,content:e};$.showPreloader("正在吐槽");$.ajax({type:"POST",data:a,dataType:"json",url:"/ask/debase",success:function(e){$.hidePreloader();console.log(e);if(e.code==200){$.toast("吐槽成功");$(".modal-dislike").hide();$(".modal-overlay-visible").show();$(".modal-dislike-send").show();console.log(e)}else{$.toast("吐槽失败");console.log(e)}},error:function(e){$.hidePreloader();console.log(result)}})});$(".buy").on("click",function(){var e=$(".buy").attr("data-buy");if(($(this).text()=="朕已查阅"||$(this).text()=="朕分享的")&&e){return}var a={username:UserName,ask_id:AskId};e=1;$.showPreloader("正在瞅瞅");$.ajax({type:"GET",data:a,dataType:"json",url:"/authorization/pay",success:function(a){console.log(a);$.hidePreloader();if(a.code==100){$.toast("购买成功");$(".buy").text("朕已查阅");$(".buy").attr("data-buy","1");$(".buyed-img").show();$(".dislike-content").show();getHide({success:function(e){var a=e.data;if(a.shopName){$(".detail-rtname").text(a.shopName)}else{$(".detail-rtname").text("暂无")}if(a.askPosition){var i=JSON.parse(a.askPosition);var t="";for(var o in i){console.log(i[o]);if(o=="adetail"){t+="（"}t+=i[o];if(o=="adetail"){t+="）"}}$(".detail-address").text(t);$(".detail-address").attr("data-GeoX",a.GeoX);$(".detail-address").attr("data-GeoY",a.GeoY)}},error:function(e){location.reload()}})}else if(a.code==200){initPay(a.payargs);e=0}else{$.toast("购买失败");e=0}},error:function(e){$.hidePreloader();$.total("网络有问题");console.log(e)}})});function onBridgeReady(e){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign},function(e){if(e.err_msg=="get_brand_wcpay_request:ok"){var a={username:UserName,ask_id:AskId};buyed=1;$.showPreloader("正在瞅瞅");getHide({success:function(e){$(".buyed-img").show();$(".dislike-content").show();$.hidePreloader();var a=e.data;if(a.shopName){$(".detail-rtname").text(a.shopName)}else{$(".detail-rtname").text("暂无")}if(a.askPosition){var i=JSON.parse(a.askPosition);var t="";for(var o in i){console.log(i[o]);t+=i[o]}$(".detail-address").text(t);$(".detail-address").attr("data-GeoX",a.GeoX);$(".detail-address").attr("data-GeoY",a.GeoY)}},error:function(e){$.hidePreloader();location.reload()}})}else{}})}function initPay(e){if(typeof WeixinJSBridge=="undefined"){if(document.addEventListener){document.addEventListener("WeixinJSBridgeReady",onBridgeReady,false)}else if(document.attachEvent){document.attachEvent("WeixinJSBridgeReady",onBridgeReady);document.attachEvent("onWeixinJSBridgeReady",onBridgeReady)}}else{onBridgeReady(e)}}function initPay(e){if(typeof WeixinJSBridge=="undefined"){if(document.addEventListener){document.addEventListener("WeixinJSBridgeReady",onBridgeReady,false)}else if(document.attachEvent){document.attachEvent("WeixinJSBridgeReady",onBridgeReady);document.attachEvent("onWeixinJSBridgeReady",onBridgeReady)}}else{onBridgeReady(e)}}